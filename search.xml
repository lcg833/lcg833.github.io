<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Android Alarm、WakeLock机制与对齐唤醒]]></title>
      <url>http://codingtrip.com/2017/03/27/0015-alian_wakeup/</url>
      <content type="html"><![CDATA[<h3 id="Android睡眠唤醒机制"><a href="#Android睡眠唤醒机制" class="headerlink" title="Android睡眠唤醒机制"></a>Android睡眠唤醒机制</h3><p>Android在标准linux内核原有睡眠唤醒模块基础上增加了WakeLock唤醒锁机制，WakeLock是Android提供给应用程序获取电力资源的唯一方法。只要还有地方在使用WakeLock，系统就不会进入休眠状态。</p>
<p>WakeLock的一般使用方法如下：<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE)<span class="comment">;</span></span><br><span class="line">PowerManager.WakeLock wl = pm.newWakeLock(PowerManager.SCREEN_DIM_WAKE_LOCK, "My Tag")<span class="comment">;</span></span><br><span class="line">wl.acquire()<span class="comment">;</span></span><br><span class="line">  ..screen will stay on during this section..</span><br><span class="line">wl.release()<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>WakeLock构造函数中有个flags参数，该参数决定了不同的wake lock等级，如下所示</p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/alignwakeup/wakelock.png" alt="wakelock"><br></div>


<h3 id="为什么要做对齐唤醒"><a href="#为什么要做对齐唤醒" class="headerlink" title="为什么要做对齐唤醒"></a>为什么要做对齐唤醒</h3><p>目前，在移动互联网的大浪潮下，基本上的APP都集成有消息推送功能，而不仅仅局限于即时通讯类应用。</p>
<p>推送技术的解决方案主要有以下几类：</p>
<p>1、<strong>轮询（pull方式）</strong>: 应用程序阶段性的与服务器进行连接并查询是否有新的消息到达<br>  由于客户端不知道服务器是否有新消息，只能通过定时向服务器询问，如果频率设定过高将消耗大量的宽带和电量，过低又导致消息延迟严重，该方案不适用于对消息有及时性需求的应用，一般不采用该方案。<br>2、<strong>SMS通知（push方式）</strong>: 通过拦截SMS消息并且解析消息内容来了解服务器的意图<br>  该方案可保证一定的实时性需求，但是需要向运营商缴纳相应的费用，所以该方案的使用也较少。<br>3、<strong>长连接（push方式）</strong>: 应用程序和服务器保持一个长连接，服务器的消息可以直接通过这个链接push到应用程序。<br>  能保证消息的实时性，并且不需要向运营商缴纳高额费用，所以基本上推送方案都是使用长连接来实现。  </p>
<h3 id="长连接、NAT超时和心跳"><a href="#长连接、NAT超时和心跳" class="headerlink" title="长连接、NAT超时和心跳"></a>长连接、NAT超时和心跳</h3><p><strong>长连接</strong>：客户端与服务器建立连接之后, 不主动断开. 双方互相发送数据, 发完了也不主动断开连接, 之后有需要发送的数据就继续通过这个连接发送.  </p>
<p><strong>NAT超时</strong>：因为IPv4的IP量有限，运营商分配给手机终端的IP是运营商内网的IP，手机要连接Internet，就需要通过运营商的网关做一个网络地址转换(Network Address Translation，NAT)。<br>简单的说运营商的网关需要维护一个外网IP、端口到内网IP、端口的对应关系，以确保内网的手机可以跟 Internet 的服务器通讯。<br>大部分移动无线网络运营商都在链路一段时间没有数据通讯时，会淘汰 NAT 表中的对应项，造成链路中断。</p>
<p>下表列出一些已测试过的网络的NAT超时时间（内容来源与网络）：</p>
<p>地区/网络    NAT超时时间<br>中国移动    5分钟<br>中国联通    5分钟<br>中国电信    大于28分钟<br>美国    大于28分钟<br>台湾    大于28分钟  </p>
<p>由于NAT超时的存在，推送为了保障消息及时性，必须维持长连接不断开，也就有了心跳机制。所谓心跳也就是客户端需要定时向服务器发送数据包，防止NAT超时。  </p>
<p>android平台多样性，产生了诸如小米、个推、友盟、阿里、百度云、极光、信鸽和华为等等众多推送平台。随着我们手机安装的应用的增多，会有各种各样的推送服务在后台运行，它们会定时唤醒机器，向自己服务器发送心跳包，但各个推送发送心跳包的时间不一致，导致机器在短时间内多次重复被唤醒，大大降低手机的续航能力。  </p>
<p>因此，对齐唤醒要解决的问题，就是将我们所有我们认为定时唤醒异常的应用，将它们的定时唤醒任务对齐，在一次唤醒中全部触发，以降低机器重复唤醒的频率。如下图，miui的官方宣传ppt中所示。</p>
<p><div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/alignwakeup/miui_align_wakeup.png" alt="miui_align_wakeup"><br></div></p>
<h2 id="对齐唤醒实现方案"><a href="#对齐唤醒实现方案" class="headerlink" title="对齐唤醒实现方案"></a>对齐唤醒实现方案</h2><p>由于市面上的各种管家类应用都存在后台清理之类功能，手机厂商自己定制rom为了续航也会清理后台进程，推送保活就成了推送的首要任务。推送需要定时向服务器发送数据包，必然需要去设定一个定时任务，由于后台清理的存在，显然应用自己实现计时器不是靠谱的方案。因此，需借助于android系统的AlarmManagerService，来定时向服务器发送心跳包。</p>
<p>所以，我们的首要任务就是将alarm对齐。</p>
<h3 id="定时唤醒——AlarmManager"><a href="#定时唤醒——AlarmManager" class="headerlink" title="定时唤醒——AlarmManager"></a>定时唤醒——AlarmManager</h3><p>AlarmManager类是为应用提供接口，以访问系统的AlarmManagerService服务的类，以便应用可以设定自己在未来某个时间点运行。当alarm到时间响应时，系统会广播之前应用所注册的intent，如果目标应用未启动，系统会将其自动启动。已注册的alarms在系统休眠时也会得到保存，但会在设备重启或者关闭时被清除。AlarmManager将会在在reveiver的onReceive()方法执行的时候一直持有wakelock锁,以保证手机在执行广播时不进入休眠状态。一旦onReceive()执行返回，AlarmManager将会释放该wakelock。</p>
<p>从Android 4.4（API Level19）开始，所有的重复闹钟都将是非精确型的，我们将借助于android原生这套方案来实现对齐唤醒的功能。</p>
<p>Alarm类型有两大类：ELAPSED_REALTIME 和 REAL_TIME_CLOCK（RTC）。<br>ELAPSED_REALTIME从系统启动之后开始计算，REAL_TIME_CLOCK使用的是世界统一时间（UTC）。也就是说由于ELAPSED_REALTIME不受地区和时区的影响，所以它适合于基于时间差的闹钟（例如一个每过30秒触发一次的闹钟）。REAL_TIME_CLOCK适合于那些依赖于地区位置的闹钟。</p>
<p>两种类型的闹钟都还有一个唤醒（WAKEUP）版本，也就是可以在设备屏幕关闭，在系统进入休眠的时候唤醒CPU。这可以确保闹钟会在既定的时间被激活，对于那些实时性要求比较高的应用（比如含有一些对执行时间有要求的操作）来说非常有效。如果你没有使用唤醒版本的闹钟，那么所有的重复闹钟会在下一次设备被唤醒时被激活。</p>
<p>下面列出闹钟的具体类型：</p>
<p>ELAPSED_REALTIME：从设备启动之后开始算起，度过了某一段特定时间后，激活Pending Intent，但不会唤醒设备。其中设备睡眠的时间也会包含在内。<br>ELAPSED_REALTIME_WAKEUP：从设备启动之后开始算起，度过了某一段特定时间后唤醒设备。<br>RTC：在某一个特定时刻激活Pending Intent，但不会唤醒设备。<br>RTC_WAKEUP：在某一个特定时刻唤醒设备并激活Pending Intent。  </p>
<p>对齐唤醒，只需要处理WAKEUP类型的闹钟。<br>下面是Android官方培训教程中的一段通过AlarmManager来设定定时任务的典型代码：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> AlarmManager alarmMgr;</span><br><span class="line"><span class="keyword">private</span> PendingIntent alarmIntent;</span><br><span class="line">...</span><br><span class="line">alarmMgr = (AlarmManager)context.getSystemService(Context.ALARM_SERVICE);</span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(context, AlarmReceiver.<span class="keyword">class</span>);</span><br><span class="line">alarmIntent = PendingIntent.getBroadcast(context, <span class="number">0</span>, intent, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">alarmMgr.<span class="built_in">set</span>(AlarmManager.ELAPSED_REALTIME_WAKEUP,</span><br><span class="line">        SystemClock.elapsedRealtime() +</span><br><span class="line">        <span class="number">60</span> * <span class="number">1000</span>, alarmIntent);</span><br></pre></td></tr></table></figure></p>
<p>除了set(int type, long triggerAtMillis, PendingIntent operation)接口之外，AlarmManager还提供了以下几个常用接口供应用调用：  </p>
<p>setRepeating(int type, long triggerAtMillis,long intervalMillis, PendingIntent operation)：设定一个重复的闹钟<br>setInexactRepeating(int type, long triggerAtMillis,long intervalMillis, PendingIntent operation)：设定一个非精准重复的闹钟<br>setExact(int type, long triggerAtMillis, PendingIntent operation)：设定一个精准时间响应闹钟<br>setWindow(int type, long windowStartMillis, long windowLengthMillis,PendingIntent operation)：设定一个指在指定windowLength内响应的闹钟（对于参数windowLengthMillis我们后续分析源码的时候再作解释）  </p>
<p><strong>注意</strong>：从Android 4.4（API Level19）开始，alarm默认设置为非精准定时，以便减少OS唤醒次数，降低电量损耗，如要实现精准定时需使用新接口setWindow(int, long, long, PendingIntent)或 setExact(int, long, PendingIntent)。  </p>
<p>阅读源码，可以很清楚看到，不管通过哪种接口设定alarm，最终调用到AlarmManagerService.java当中的setImpl(type, triggerAtTime, windowLength, interval, operation, flags, workSource, alarmClock, callingUid)方法，如下。（具体调用流程不在本文分析）</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">..\frameworks\base\services\core\java\com\android\server\AlarmManagerService.java</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setImpl</span><span class="params">(<span class="keyword">int</span> type, <span class="keyword">long</span> triggerAtTime, <span class="keyword">long</span> windowLength, <span class="keyword">long</span> interval,</span><br><span class="line">        PendingIntent operation, <span class="keyword">int</span> flags, WorkSource workSource,</span><br><span class="line">        AlarmManager.AlarmClockInfo alarmClock, <span class="keyword">int</span> callingUid)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断PendingIntent是否为空，一个alarm必须含有对应的PendingIntent</span></span><br><span class="line">    <span class="keyword">if</span> (operation == <span class="keyword">null</span>) &#123;</span><br><span class="line">        Slog.w(TAG, <span class="string">"set/setRepeating ignored because there is no intent"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检测windowLength参数，纠正粗心的开发者所设定的错误值，如果大于12小时，将被强制纠正设定为1个小时</span></span><br><span class="line">    <span class="comment">// Sanity check the window length.  This will catch people mistakenly</span></span><br><span class="line">    <span class="comment">// trying to pass an end-of-window timestamp rather than a duration.</span></span><br><span class="line">    <span class="keyword">if</span> (windowLength &gt; AlarmManager.INTERVAL_HALF_DAY) &#123;</span><br><span class="line">        Slog.w(TAG, <span class="string">"Window length "</span> + windowLength</span><br><span class="line">                + <span class="string">"ms suspiciously long; limiting to 1 hour"</span>);</span><br><span class="line">        windowLength = AlarmManager.INTERVAL_HOUR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查重复闹钟间隔时间，最小为间隔时间为1分钟</span></span><br><span class="line">    <span class="comment">// Sanity check the recurrence interval.  This will catch people who supply</span></span><br><span class="line">    <span class="comment">// seconds when the API expects milliseconds.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> minInterval = mConstants.MIN_INTERVAL;</span><br><span class="line">    <span class="keyword">if</span> (interval &gt; <span class="number">0</span> &amp;&amp; interval &lt; minInterval) &#123;</span><br><span class="line">        Slog.w(TAG, <span class="string">"Suspiciously short interval "</span> + interval</span><br><span class="line">                + <span class="string">" millis; expanding to "</span> + (minInterval/<span class="number">1000</span>)</span><br><span class="line">                + <span class="string">" seconds"</span>);</span><br><span class="line">        interval = minInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进行alarm type的合法性检查</span></span><br><span class="line">    <span class="keyword">if</span> (type &lt; RTC_WAKEUP || type &gt; ELAPSED_REALTIME) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Invalid alarm type "</span> + type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查alarm触发时间</span></span><br><span class="line">    <span class="keyword">if</span> (triggerAtTime &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> what = Binder.getCallingPid();</span><br><span class="line">        Slog.w(TAG, <span class="string">"Invalid alarm trigger time! "</span> + triggerAtTime + <span class="string">" from uid="</span> + callingUid</span><br><span class="line">                + <span class="string">" pid="</span> + what);</span><br><span class="line">        triggerAtTime = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开机距离现在时长</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> nowElapsed = SystemClock.elapsedRealtime();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据alarm type类型进行触发时间转换</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> nominalTrigger = convertToElapsed(triggerAtTime, type);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了防止alarm立刻触发，添加最小触发时间（5s）</span></span><br><span class="line">    <span class="comment">// Try to prevent spamming by making sure we aren't firing alarms in the immediate future</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> minTrigger = nowElapsed + mConstants.MIN_FUTURITY;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过名义上的触发时间与最小触发时间判断，获取真正的触发时间</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> triggerElapsed = (nominalTrigger &gt; minTrigger) ? nominalTrigger : minTrigger;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算最长触发时间</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> maxElapsed;</span><br><span class="line">    <span class="keyword">if</span> (windowLength == AlarmManager.WINDOW_EXACT) &#123;</span><br><span class="line">        <span class="comment">//精准闹钟立刻触发，最长触发时间等于意图触发时间</span></span><br><span class="line">        maxElapsed = triggerElapsed;</span><br><span class="line">    &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(windowLength &lt; <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据算法得出最大触发时间</span></span><br><span class="line">        maxElapsed = maxTriggerTime(nowElapsed, triggerElapsed, interval);</span><br><span class="line">        <span class="comment">// Fix this window in place, so that as time approaches we don't collapse it.</span></span><br><span class="line">        windowLength = maxElapsed - triggerElapsed;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//对于设置windowLength&gt;0的alarm，最长触发时间=意图触发时间+windowLength</span></span><br><span class="line">        maxElapsed = triggerElapsed + windowLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG_BATCH) &#123;</span><br><span class="line">            Slog.v(TAG, <span class="string">"set("</span> + operation + <span class="string">") : type="</span> + type</span><br><span class="line">                    + <span class="string">" triggerAtTime="</span> + triggerAtTime + <span class="string">" win="</span> + windowLength</span><br><span class="line">                    + <span class="string">" tElapsed="</span> + triggerElapsed + <span class="string">" maxElapsed="</span> + maxElapsed</span><br><span class="line">                    + <span class="string">" interval="</span> + interval + <span class="string">" flags=0x"</span> + Integer.toHexString(flags));</span><br><span class="line">        &#125;</span><br><span class="line">        setImplLocked(type, triggerAtTime, triggerElapsed, windowLength, maxElapsed,</span><br><span class="line">                interval, operation, flags, <span class="keyword">true</span>, workSource, alarmClock, callingUid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述方法当中有个重要的参数windowLength（时间窗口长度），这个参数将会决定alarm的真正触发时间。<br>我们之前有提到，从android 4.4之后开始，所有的alarm默认都是非精准的，除非显式调用设定为精准模式。<br>在非精准模式下，Alarm是批量提醒的，每个alarm根据其触发时间和最大触发时间的不同会被加入到不同的batch中，同一个batch的不同alarm是同时发生的。同时所有的batch是按开始时间升序排列的，在一个batch内部，不同的闹钟也是按触发时间升序排列的，所以闹钟的唤醒顺序是按照batch的排序依次触发的，而同一个batch中的alarm是同时触发的。</p>
<p>我们要做的工作就是基于xposed框架，hook该函数，将所有我们认为是定时唤醒异常的应用所设定的唤醒类alarm，添加一个windowLength时长，将它们加入到合适的batch当中，来实现在一次唤醒当中处理多次唤醒任务。</p>
<h3 id="非定时唤醒"><a href="#非定时唤醒" class="headerlink" title="非定时唤醒"></a>非定时唤醒</h3><p>我们上面提到的定时唤醒，AlarmManager在执行PendingIntent中的onReceive方法时会持有一个wakelock锁。其实应用也能直接申请WakeLock唤醒锁，对于这种直接申请WakeLock锁的情形，我们统一将其划分为非定时唤醒类。</p>
<p>对于非定时唤醒处理，由于它不像定时器是在未来某个时间点才触发，而是即刻持有即刻唤醒。由于我们无法判定当一个应用直接申请wakelock锁的，下一个wakelock唤醒锁会在什么时间申请，很难像AlarmManager去设定一个合适的时间维护窗口来管理。并且，我们不清楚应用唤醒锁持有阶段意图执行的具体任务,也就是说无法获知应用在执行acquire()和release()方法之间执行什么样的代码操作，所以无法将其意图执行任务进行缓存，等待其他wakelock申请时一起执行。</p>
<p>对于这种情形，个人认为应该结合实际场景来考虑：</p>
<p>场景一：对于用户非主动触发唤醒（比如按power键）达到一定时长（1小时）的情形<br>1.只允许应用申请PARTIAL_WAKE_LOCK类型唤醒锁，对于其他申请的唤醒锁类型，强制替换成PARTIAL_WAKE_LOCK，也就是说只允许cpu唤醒，不允许屏幕和键盘亮起。  </p>
<p>2.同时，设定允许最小唤醒屏幕和键盘亮起唤醒时间，当非PARTIAL_WAKE_LOCK唤醒锁申请时，判断上一次屏幕亮起的时间距离现在的时长是否超过所允许的最新唤醒时间，如果是则允许亮屏唤醒。  </p>
<p>场景二：新接收到即时通讯类APP通知消息  </p>
<p>当通知栏新增第一条该应用通知消息时，允许屏幕唤醒，从此刻开始到在下一次进入黑屏时间内，如果用户没有进入该应用，或未点击该消息通知，或未主动清除消息通知。则在下一次通知消息来临时，判断距离上次亮屏时间是否大于所设定的最小时长（比如15分钟），如果是则允许亮屏，否则不允许亮屏。  </p>
]]></content>
      
        
        <tags>
            
            <tag> Framework </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Gitlab 使用]]></title>
      <url>http://codingtrip.com/2016/11/29/0007_GitLab%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<h3 id="一、获取项目代码"><a href="#一、获取项目代码" class="headerlink" title="一、获取项目代码"></a>一、获取项目代码</h3><p>登陆之后，你会看到下图的界面。界面右边是你所参与的项目</p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片2.png" alt="GitLab"><br></div>

<p>点击项目名称，可进入相应项目界面<br><a id="more"></a></p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片3.png" alt="GitLab"><br></div>

<h4 id="1、提交SSH-KEY"><a href="#1、提交SSH-KEY" class="headerlink" title="1、提交SSH-KEY"></a>1、提交SSH-KEY</h4><p>首先你会看到橙色的提示，要你提供你的SSH-KEY, 请按照提示来添加你的公钥。<br>① 如果之前有生成过私钥和公钥，可直接在你的~/.ssh 目录看到id_rsa、id_rsa.pub这两个文件，将id_rsa.pub文件内容添加即可<br>② 如果未生成过的话，可通过终端输入以下命令生成<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure></p>
<p>③ 如果后续想更改或者增减新的SSH-KEY，可在Profile Settings界面里（非Project设置界面），选择SSH Keys进行操作</p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片4.png" alt="GitLab"><br></div>

<h4 id="2、获取代码"><a href="#2、获取代码" class="headerlink" title="2、获取代码"></a>2、获取代码</h4><p>界面上显示你可以通过http和ssh两种方式来获取代码，我们建议使用SSH.这样可以减少你反复输入密码。</p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片5.png" alt="GitLab"><br></div>

<p>点击<img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片6.png" alt="GitLab">可直接copy到当前git地址：git@kf2GitHUB:20248760/VersionManager.git</p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片7.png" alt="GitLab"><br></div>

<p>由于我们本机无法自动解析@kf2GitHUB地址，有两种处理方法：  </p>
<h5 id="①-直接将kf2GitHUB替换成：172-28-2-93"><a href="#①-直接将kf2GitHUB替换成：172-28-2-93" class="headerlink" title="① 直接将kf2GitHUB替换成：172.28.2.93"></a>① 直接将kf2GitHUB替换成：172.28.2.93</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@<span class="number">172.28</span><span class="number">.2</span><span class="number">.93</span>:<span class="number">20248760</span>/VersionManager.git</span><br></pre></td></tr></table></figure>
<h5 id="②-配置-ssh-config-文件，添加如下内容"><a href="#②-配置-ssh-config-文件，添加如下内容" class="headerlink" title="② 配置  ~/.ssh/config 文件，添加如下内容"></a>② 配置  ~/.ssh/config 文件，添加如下内容</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">host kf2GitHUB</span><br><span class="line">user git</span><br><span class="line">hostname <span class="number">172.28</span><span class="number">.2</span><span class="number">.93</span></span><br><span class="line">port <span class="number">22</span></span><br><span class="line">identityfile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<p>配置成功后，可使用以下命令即可直接clone代码了：<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">git</span>@kf2GitHUB:<span class="number">20248760</span>/VersionManager.git</span><br></pre></td></tr></table></figure></p>
<p>如果出现以下提示：  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片8.png" alt="GitLab"><br></div>  

<p>输入：ssh-add 即可解决</p>
<h3 id="二、创建项目以及团队管理"><a href="#二、创建项目以及团队管理" class="headerlink" title="二、创建项目以及团队管理"></a>二、创建项目以及团队管理</h3><h4 id="1、创建项目"><a href="#1、创建项目" class="headerlink" title="1、创建项目"></a>1、创建项目</h4><p>回到Projects视图窗口，如下图，点击右侧New Project即可创建一个新的项目  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片9.png" alt="GitLab"><br></div>

<p>如下图中红色框中所示，第一项填入你的项目名称，然后选择可访问级别，选择Internal——对登录用户才能进行clone操作，点击Create Project即可完成创建操作  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片10.png" alt="GitLab"><br></div>

<p>创建成功之后会看到如下界面  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片11.png" alt="GitLab"><br></div>

<p>如中间红色框所示：  </p>
<h5 id="①-如果之前未进行过config配置，可使用以下命令进行配置（为了在git提交记录里显示你的信息）"><a href="#①-如果之前未进行过config配置，可使用以下命令进行配置（为了在git提交记录里显示你的信息）" class="headerlink" title="① 如果之前未进行过config配置，可使用以下命令进行配置（为了在git提交记录里显示你的信息）"></a>① 如果之前未进行过config配置，可使用以下命令进行配置（为了在git提交记录里显示你的信息）</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user<span class="class">.name</span> <span class="string">"罗才干"</span></span><br><span class="line">git config --global user<span class="class">.email</span> <span class="string">"lcg833@163.com"</span></span><br></pre></td></tr></table></figure>
<h5 id="②-创建一个新的仓库"><a href="#②-创建一个新的仓库" class="headerlink" title="② 创建一个新的仓库"></a>② 创建一个新的仓库</h5><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">git</span>@kf2GitHUB:<span class="number">20248760</span>/AwesomeTest.git</span><br><span class="line">cd AwesomeTest</span><br><span class="line">//然后把你的项目文件添加到该目录下</span><br><span class="line">git commit -m <span class="string">"本次修改的log信息"</span></span><br><span class="line">git push -u origin <span class="literal">master</span></span><br></pre></td></tr></table></figure>
<h5 id="③-项目文件夹已经存在"><a href="#③-项目文件夹已经存在" class="headerlink" title="③ 项目文件夹已经存在"></a>③ 项目文件夹已经存在</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd existing_folder</span><br><span class="line">git init <span class="comment">//如果之前已经存在git仓库，跳过此步操作</span></span><br><span class="line">git remote add GitLab git@<span class="number">172.28</span><span class="number">.2</span><span class="number">.93</span>:<span class="number">20248760</span>/AwesomeTest.git <span class="comment">//增加新的远程仓库</span></span><br><span class="line">git add .</span><br><span class="line">git commit</span><br><span class="line">git push -u GitLab master <span class="comment">//切换默认远程仓库和分支</span></span><br></pre></td></tr></table></figure>
<p>如果之前该项目下已经存在一个git仓库，推荐使用第三种方式，可以在新仓库中保留所有原仓库中所有提交历史！  </p>
<h4 id="2、项目成员管理"><a href="#2、项目成员管理" class="headerlink" title="2、项目成员管理"></a>2、项目成员管理</h4><p>在Project视图，点击Members，可进行项目成员管理，如需添加新成员，如图所示完成三步操作即可：选择成员——分配权限（如需参与提交代码，权限等级不得低于Developer）——Add users to project  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片12.png" alt="GitLab"><br></div>  

<p>关于权限，master拥有最高管理权限，分配时应慎重，一般来说Developer权限足够了，除非该成员需要进行代码审核  </p>
<h3 id="三、代码提交以及审核流程："><a href="#三、代码提交以及审核流程：" class="headerlink" title="三、代码提交以及审核流程："></a>三、代码提交以及审核流程：</h3><p>每个团队研发有自己的开发分支：比如framework组有dev_framework_android分支。<br>每个软件工程师在自己团队的分支上开发和提交，可以push代码到开发分支，但是不允许merge代码到主干分支。这个merge的操作由merge request机制来完成，团队定期审核团队内提交的代码。并由专人接受审核申请，完成合并到主干的工作。  </p>
<h4 id="1、如何查看提交"><a href="#1、如何查看提交" class="headerlink" title="1、如何查看提交"></a>1、如何查看提交</h4><p>左侧项目菜单有个Commits项，点击，就可以看到项目目前的所有提交。  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片13.png" alt="GitLab"><br></div>

<p>点击提交记录的一项，你可以看到这个提交的详情。  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片14.png" alt="GitLab"><br></div>

<h4 id="2、如何发起merge-request请求"><a href="#2、如何发起merge-request请求" class="headerlink" title="2、如何发起merge request请求"></a>2、如何发起merge request请求</h4><p>Project视图，选择Commits，找到对应的分支，点击Merge Request发起merge请求  </p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/other/gitlab/图片15.png" alt="GitLab"><br></div>
]]></content>
      
        <categories>
            
            <category> 其他 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GitLab </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[在Mac OS中获取和编译android源码(AOSP)]]></title>
      <url>http://codingtrip.com/2016/08/26/0014-mac-aosp/</url>
      <content type="html"><![CDATA[<p>android源码的获取和编译教程，Google官方有详细的教程，建议直接看官方教程，链接如下：<br><a href="https://source.android.com/source/requirements.html" target="_blank" rel="external">https://source.android.com/source/requirements.html</a></p>
<h3 id="编译环境要求"><a href="#编译环境要求" class="headerlink" title="编译环境要求"></a>编译环境要求</h3><p>先介绍下我的电脑基础环境：<br>1.硬件：MacBook Pro<br>2.系统版本：OS X EI Capitan 10.11.6</p>
<h4 id="一、系统版本要求"><a href="#一、系统版本要求" class="headerlink" title="一、系统版本要求"></a>一、系统版本要求</h4><p>以下是官方给出的各个android版本建议对应的系统版本：</p>
<h5 id="GNU-Linux"><a href="#GNU-Linux" class="headerlink" title="GNU/Linux"></a>GNU/Linux</h5><p>Android 6.0 (Marshmallow) - AOSP master: Ubuntu 14.04 (Trusty)<br>Android 2.3.x (Gingerbread) - Android 5.x (Lollipop): Ubuntu 12.04 (Precise)<br>Android 1.5 (Cupcake) - Android 2.2.x (Froyo): Ubuntu 10.04 (Lucid)  </p>
<h5 id="Mac-OS-Intel-x86"><a href="#Mac-OS-Intel-x86" class="headerlink" title="Mac OS (Intel/x86)"></a>Mac OS (Intel/x86)</h5><p>Android 6.0 (Marshmallow) - AOSP master: Mac OS v10.10 (Yosemite) or later with Xcode 4.5.2 and Command Line Tools<br>Android 5.x (Lollipop): Mac OS v10.8 (Mountain Lion) with Xcode 4.5.2 and Command Line Tools<br>Android 4.1.x-4.3.x (Jelly Bean) - Android 4.4.x (KitKat): Mac OS v10.6 (Snow Leopard) or Mac OS X v10.7 (Lion) and Xcode 4.2 (Apple’s Developer Tools)<br>Android 1.5 (Cupcake) - Android 4.0.x (Ice Cream Sandwich): Mac OS v10.5 (Leopard) or Mac OS X v10.6 (Snow Leopard) and the Mac OS X v10.5 SDK<br><a id="more"></a>  </p>
<h4 id="二、JDK版本要求"><a href="#二、JDK版本要求" class="headerlink" title="二、JDK版本要求"></a>二、JDK版本要求</h4><p>The master branch of Android in AOSP: Ubuntu - OpenJDK 8, Mac OS - jdk 8u45 or newer<br>Android 5.x (Lollipop) - Android 6.0 (Marshmallow): Ubuntu - OpenJDK 7, Mac OS - jdk-7u71-macosx-x64.dmg<br>Android 2.3.x (Gingerbread) - Android 4.4.x (KitKat): Ubuntu - Java JDK 6, Mac OS - Java JDK 6<br>Android 1.5 (Cupcake) - Android 2.2.x (Froyo): Ubuntu - Java JDK 5  </p>
<h3 id="编译环境搭建"><a href="#编译环境搭建" class="headerlink" title="编译环境搭建"></a>编译环境搭建</h3><p>（以下内容记录的是在Mac上的搭建过程，其余系统请移步<a href="https://source.android.com/source/initializing.html" target="_blank" rel="external">android官方文档</a>）</p>
<h4 id="1-建立一个区分大小的分区-OS-X中默认分区文件系统是不区分大小写的"><a href="#1-建立一个区分大小的分区-OS-X中默认分区文件系统是不区分大小写的" class="headerlink" title="1.建立一个区分大小的分区(OS X中默认分区文件系统是不区分大小写的)"></a>1.建立一个区分大小的分区(OS X中默认分区文件系统是不区分大小写的)</h4><p>直接在终端运行以下命令，即可建立一块大小为40g的分区，如果要创建其他的大小的分区，将命令中的40改为对应的数字即可。个人实测建议，这个分区尽量大一些，以我自己为例，我下载的是android－6.0 nexus5分支的源码，完成同步并编译之后大概占用了70G<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hdiutil <span class="operator"><span class="keyword">create</span> -<span class="keyword">type</span> <span class="keyword">SPARSE</span> -fs <span class="string">'Case-sensitive Journaled HFS+'</span> -<span class="keyword">size</span> <span class="number">40</span><span class="keyword">g</span> ~/android.dmg</span></span><br></pre></td></tr></table></figure></p>
<p>上述命令将会生成一个以.dmg或.dmg.sparseimage为后缀的文件  </p>
<p>如果已经创建好了这个分区，想再去更改它的大小，可以通过以下命令实现<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hdiutil resize -<span class="keyword">size</span> &lt;<span class="keyword">new</span>-<span class="keyword">size</span>-you-want&gt;g ~<span class="regexp">/android.dmg.sparseimage</span></span><br></pre></td></tr></table></figure></p>
<p>2.将创建好的这个镜像挂载到系统中<br>在文件~/.bash_profile中配置以下内容。（如果该文件不存在，可通过touch命令先生成，然后再将内容添加）<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 挂载镜像文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountAndroid</span> </span>&#123; hdiutil attach ~/android.dmg -mountpoint /Volumes/android; &#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 卸载镜像文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unmountAndroid</span><span class="params">()</span> </span>&#123; hdiutil detach /Volumes/android; &#125;</span><br></pre></td></tr></table></figure></p>
<p>(如果镜像文件是以.dmg.sparseimage为后缀，则将命令中的~/android.dmg 替换为 ~/android.dmg.sparseimage）</p>
<p>3.下载并安装jdk<br>上<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">oracle官网</a>，对照前面所提的不同的android版本所需jdk下载安装即可<br>4.在appstore中安装Xcode<br>5.安装<a href="https://www.macports.org/install.php" target="_blank" rel="external">MacPorts</a><br>确保path环境变量中/opt/local/bin在/usr/bin之前，否则添加以下内容到～/.bash_profile<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/opt/local/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure></p>
<p>6.通过MacPorts安装make, git, 和 GPG等<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="type">POSIXLY_CORRECT</span>=<span class="number">1</span> sudo <span class="foreign"><span class="keyword">port</span> install gmake libsdl git gnupg</span></span><br></pre></td></tr></table></figure></p>
<p>7、在~/.bash_profile中配置文件限制<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="operator"><span class="keyword">set</span> the <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">open</span> files <span class="keyword">to</span> be <span class="number">1024</span></span><br><span class="line">ulimit -S -<span class="keyword">n</span> <span class="number">1024</span></span></span><br></pre></td></tr></table></figure></p>
<p>8、配置缓存<br>在源码的根目录下，打开终端输入以下命令，即可配置编译运行缓存，建议大小为50～100G<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">export</span> USE_CCACHE=<span class="number">1</span></span><br><span class="line">$ <span class="keyword">export</span> CCACHE_DIR=/&lt;path_of_your_choice&gt;/.ccache</span><br><span class="line">$ prebuilts/misc/darwin-x86/ccache/ccache -M <span class="number">50</span>G</span><br></pre></td></tr></table></figure></p>
<p>在.bashrc中加入内容：export USE_CCACHE=1</p>
<h3 id="四、下载源码"><a href="#四、下载源码" class="headerlink" title="四、下载源码"></a>四、下载源码</h3><p><strong>1.</strong>在home根目录下建立一个bin文件夹并添加到环境变量中：<br>$ mkdir ~/bin<br>$ PATH=~/bin:$PATH  </p>
<p><strong>2.</strong>下载repo工具<br>$ curl <a href="https://storage.googleapis.com/git-repo-downloads/repo" target="_blank" rel="external">https://storage.googleapis.com/git-repo-downloads/repo</a> &gt; ~/bin/repo<br>$ chmod a+x ~/bin/repo  </p>
<p><strong>3.</strong>在上面创建的区分大小写的镜像中建立一个编译根目录(名字随意取)：WORKING_DIRECTORY<br>$ mkdir WORKING_DIRECTORY<br>$ cd WORKING_DIRECTORY  </p>
<p><strong>4.</strong>配置git用户名和账号邮箱信息<br>$ git config –global user.name “Your Name”<br>$ git config –global user.email   “you@example.com”<br><strong>5.</strong>init源码分支<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>repo init -u <span class="symbol">https:</span>/<span class="regexp">/android.googlesource.com/platform</span><span class="regexp">/manifest</span></span><br></pre></td></tr></table></figure></p>
<p>如果提示无法连接到 gerrit.googlesource.com，可以将源换成清华的，编辑 ~/bin/repo，把 REPO_URL 一行替换成下面的：<br>REPO_URL = ‘<a href="https://gerrit-google.tuna.tsinghua.edu.cn/git-repo" target="_blank" rel="external">https://gerrit-google.tuna.tsinghua.edu.cn/git-repo</a>‘<br>更加详细操作可<a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="external">点击</a>该链接进行查看<br>如果想clone具体的分支，可加上-b参数，我想编译的是nexus 5，android 6.0，点击这个[链接]可查看具体的分支名,可以看到我想要的具体分支名为：android-6.0.1_r60<br>所以命令为：<br>$ repo init -u <a href="https://android.googlesource.com/platform/manifest" target="_blank" rel="external">https://android.googlesource.com/platform/manifest</a> -b android-6.0.1_r60  </p>
<p><strong>6.</strong>开始同步<br>在源码根目录下打开终端执行：repo sync，即可开始代码同步过程，经历的将是漫长的等待，毕竟即使个G的代码。。。</p>
<h3 id="四、编译源码"><a href="#四、编译源码" class="headerlink" title="四、编译源码"></a>四、编译源码</h3><p><strong>1.</strong>make clobber：清理out目录，如果每次都想重新编译的话，可执行该命令清除上次编译生成的OUT目录  </p>
<p>2.source build/envsetup.sh：初始化编译环境  </p>
<p>3.lunch  </p>
<p>4.输入对应target的数字（因为我要编译的是userdebug版本 19. aosp_hammerhead-userdebug所以直接输入19即可）  </p>
<p>5.make -j4:开始编译，至于是4个线程同时编译还是8个或者16个自行根据自己电脑的配置来决定  </p>
<h3 id="五、烧录镜像到机器中"><a href="#五、烧录镜像到机器中" class="headerlink" title="五、烧录镜像到机器中"></a>五、烧录镜像到机器中</h3><p>如果编译一切顺利，就可以实行最后一步了，就是我们常说的刷机<br>cd $OUT：切换到out目录<br>手机重启进入bootloader模式<br>fastboot flashall -w：执行该命令开始刷机  </p>
<h3 id="六、纪录遇到的坑"><a href="#六、纪录遇到的坑" class="headerlink" title="六、纪录遇到的坑"></a>六、纪录遇到的坑</h3><p>1.Xcode版本问题：Can not find SDK 10.6 at /Developer/SDKs/MacOSX10.6.sdk<br>这个问题是由于我们系统的版本比较高，所以sdk版本也比较高了，此时需要更改sdk配置</p>
<p>cd /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs<br>ls //查看sdk版本(我的版本为 MacOSX10.11.sdk)<br>然后编辑build/core/combo/mac_version.mk中的mac_sdk_versions_supported所在的行添加10.11  </p>
]]></content>
      
        
        <tags>
            
            <tag> AOSP </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[dumpsys命令]]></title>
      <url>http://codingtrip.com/2016/06/23/0013-adb-shell-dumpsys/</url>
      <content type="html"><![CDATA[<h3 id="查看dump服务"><a href="#查看dump服务" class="headerlink" title="查看dump服务"></a>查看dump服务</h3><p>通过命令<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb <span class="keyword">shell</span> dumpsys -<span class="keyword">l</span></span><br></pre></td></tr></table></figure></p>
<p>可查看该机器支持的所有dump服务：</p>
<p>（以nexus 5 Android 6.0为例）</p>
<a id="more"></a>  
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">lcg@ubuntu:~$ adb shell dumpsys -l</span><br><span class="line">Currently running services:</span><br><span class="line">  DockObserver</span><br><span class="line">  SurfaceFlinger</span><br><span class="line">  accessibility</span><br><span class="line">  account</span><br><span class="line">  activity</span><br><span class="line">  alarm</span><br><span class="line">  android<span class="class">.security</span><span class="class">.keystore</span></span><br><span class="line">  appops</span><br><span class="line">  appwidget</span><br><span class="line">  assetatlas</span><br><span class="line">  <span class="tag">audio</span></span><br><span class="line">  backup</span><br><span class="line">  batterymanager</span><br><span class="line">  batteryproperties</span><br><span class="line">  batterystats</span><br><span class="line">  bluetooth_manager</span><br><span class="line">  carrier_config</span><br><span class="line">  clipboard</span><br><span class="line">  cmappsuggest</span><br><span class="line">  cmaudio</span><br><span class="line">  cmhardware</span><br><span class="line">  cmiconcache</span><br><span class="line">  cmlivedisplay</span><br><span class="line">  cmlivelockscreen</span><br><span class="line">  cmpartnerinterface</span><br><span class="line">  cmperformance</span><br><span class="line">  cmstatusbar</span><br><span class="line">  cmtelephonymanager</span><br><span class="line">  cmthemes</span><br><span class="line">  cmweather</span><br><span class="line">  commontime_management</span><br><span class="line">  connectivity</span><br><span class="line">  consumer_ir</span><br><span class="line">  <span class="attribute">content</span></span><br><span class="line">  country_detector</span><br><span class="line">  cpuinfo</span><br><span class="line">  dbinfo</span><br><span class="line">  device_policy</span><br><span class="line">  deviceidle</span><br><span class="line">  devicestoragemonitor</span><br><span class="line">  diskstats</span><br><span class="line">  <span class="attribute">display</span></span><br><span class="line">  <span class="attribute">display</span><span class="class">.qservice</span></span><br><span class="line">  dreams</span><br><span class="line">  drm<span class="class">.drmManager</span></span><br><span class="line">  dropbox</span><br><span class="line">  ethernet</span><br><span class="line">  fingerprint</span><br><span class="line">  gfxinfo</span><br><span class="line">  graphicsstats</span><br><span class="line">  imms</span><br><span class="line">  <span class="tag">input</span></span><br><span class="line">  input_method</span><br><span class="line">  iphonesubinfo</span><br><span class="line">  isms</span><br><span class="line">  isub</span><br><span class="line">  jobscheduler</span><br><span class="line">  launcherapps</span><br><span class="line">  location</span><br><span class="line">  lock_settings</span><br><span class="line">  media<span class="class">.audio_flinger</span></span><br><span class="line">  media<span class="class">.audio_policy</span></span><br><span class="line">  media<span class="class">.camera</span></span><br><span class="line">  media<span class="class">.camera</span><span class="class">.proxy</span></span><br><span class="line">  media<span class="class">.player</span></span><br><span class="line">  media<span class="class">.radio</span></span><br><span class="line">  media<span class="class">.resource_manager</span></span><br><span class="line">  media<span class="class">.sound_trigger_hw</span></span><br><span class="line">  media_projection</span><br><span class="line">  media_router</span><br><span class="line">  media_session</span><br><span class="line">  meminfo</span><br><span class="line">  midi</span><br><span class="line">  mount</span><br><span class="line">  netpolicy</span><br><span class="line">  netstats</span><br><span class="line">  network_management</span><br><span class="line">  network_score</span><br><span class="line">  nfc</span><br><span class="line">  notification</span><br><span class="line">  package</span><br><span class="line">  permission</span><br><span class="line">  phone</span><br><span class="line">  power</span><br><span class="line">  print</span><br><span class="line">  processinfo</span><br><span class="line">  procstats</span><br><span class="line">  profile</span><br><span class="line">  restrictions</span><br><span class="line">  rttmanager</span><br><span class="line">  samplingprofiler</span><br><span class="line">  scheduling_policy</span><br><span class="line">  search</span><br><span class="line">  sensorservice</span><br><span class="line">  serial</span><br><span class="line">  servicediscovery</span><br><span class="line">  simphonebook</span><br><span class="line">  sip</span><br><span class="line">  statusbar</span><br><span class="line">  telecom</span><br><span class="line">  telephony<span class="class">.registry</span></span><br><span class="line">  textservices</span><br><span class="line">  trust</span><br><span class="line">  uimode</span><br><span class="line">  updatelock</span><br><span class="line">  usagestats</span><br><span class="line">  usb</span><br><span class="line">  user</span><br><span class="line">  vibrator</span><br><span class="line">  voiceinteraction</span><br><span class="line">  wallpaper</span><br><span class="line">  webviewupdate</span><br><span class="line">  wifi</span><br><span class="line">  wifip2p</span><br><span class="line">  wifiscanner</span><br><span class="line">  window</span><br></pre></td></tr></table></figure>
<p>通过命令<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service <span class="type">list</span></span><br></pre></td></tr></table></figure></p>
<p>可进一步了解以上服务名具体对应的服务：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">shell@M1000:/ $ service list                                                   </span><br><span class="line">Found <span class="number">126</span> services:</span><br><span class="line"><span class="number">0</span>	GpuAppSpectatorService: [com<span class="class">.mediatek</span><span class="class">.GpuAppSpectatorService</span>]</span><br><span class="line"><span class="number">1</span>	sip: [android<span class="class">.net</span><span class="class">.sip</span><span class="class">.ISipService</span>]</span><br><span class="line"><span class="number">2</span>	telecom: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telecom</span><span class="class">.ITelecomService</span>]</span><br><span class="line"><span class="number">3</span>	carrier_config: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.ICarrierConfigLoader</span>]</span><br><span class="line"><span class="number">4</span>	phoneEx: [com<span class="class">.mediatek</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.ITelephonyEx</span>]</span><br><span class="line"><span class="number">5</span>	phone: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.ITelephony</span>]</span><br><span class="line"><span class="number">6</span>	isms: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.ISms</span>]</span><br><span class="line"><span class="number">7</span>	iphonesubinfo: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.IPhoneSubInfo</span>]</span><br><span class="line"><span class="number">8</span>	simphonebook: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.IIccPhoneBook</span>]</span><br><span class="line"><span class="number">9</span>	isub: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.ISub</span>]</span><br><span class="line"><span class="number">10</span>	GbaService: [com<span class="class">.mediatek</span><span class="class">.gba</span><span class="class">.IGbaService</span>]</span><br><span class="line"><span class="number">11</span>	ims: [com<span class="class">.android</span><span class="class">.ims</span><span class="class">.internal</span><span class="class">.IImsService</span>]</span><br><span class="line"><span class="number">12</span>	vie_command: [com<span class="class">.mediatek</span><span class="class">.common</span><span class="class">.voiceextension</span><span class="class">.IVoiceExtCommandManager</span>]</span><br><span class="line"><span class="number">13</span>	imms: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.IMms</span>]</span><br><span class="line"><span class="number">14</span>	media_projection: [android<span class="class">.media</span><span class="class">.projection</span><span class="class">.IMediaProjectionManager</span>]</span><br><span class="line"><span class="number">15</span>	mtk-perfservice: [com<span class="class">.mediatek</span><span class="class">.perfservice</span><span class="class">.IPerfService</span>]</span><br><span class="line"><span class="number">16</span>	launcherapps: [android<span class="class">.content</span><span class="class">.pm</span><span class="class">.ILauncherApps</span>]</span><br><span class="line"><span class="number">17</span>	fingerprint: [android<span class="class">.hardware</span><span class="class">.fingerprint</span><span class="class">.IFingerprintService</span>]</span><br><span class="line"><span class="number">18</span>	trust: [android<span class="class">.app</span><span class="class">.trust</span><span class="class">.ITrustManager</span>]</span><br><span class="line"><span class="number">19</span>	media_router: [android<span class="class">.media</span><span class="class">.IMediaRouterService</span>]</span><br><span class="line"><span class="number">20</span>	media_session: [android<span class="class">.media</span><span class="class">.session</span><span class="class">.ISessionManager</span>]</span><br><span class="line"><span class="number">21</span>	restrictions: [android<span class="class">.content</span><span class="class">.IRestrictionsManager</span>]</span><br><span class="line"><span class="number">22</span>	print: [android<span class="class">.print</span><span class="class">.IPrintManager</span>]</span><br><span class="line"><span class="number">23</span>	graphicsstats: [android<span class="class">.view</span><span class="class">.IGraphicsStats</span>]</span><br><span class="line"><span class="number">24</span>	assetatlas: [android<span class="class">.view</span><span class="class">.IAssetAtlas</span>]</span><br><span class="line"><span class="number">25</span>	dreams: [android<span class="class">.service</span><span class="class">.dreams</span><span class="class">.IDreamManager</span>]</span><br><span class="line"><span class="number">26</span>	commontime_management: []</span><br><span class="line"><span class="number">27</span>	samplingprofiler: []</span><br><span class="line"><span class="number">28</span>	diskstats: []</span><br><span class="line"><span class="number">29</span>	voiceinteraction: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.app</span><span class="class">.IVoiceInteractionManagerService</span>]</span><br><span class="line"><span class="number">30</span>	appwidget: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.appwidget</span><span class="class">.IAppWidgetService</span>]</span><br><span class="line"><span class="number">31</span>	backup: [android<span class="class">.app</span><span class="class">.backup</span><span class="class">.IBackupManager</span>]</span><br><span class="line"><span class="number">32</span>	jobscheduler: [android<span class="class">.app</span><span class="class">.job</span><span class="class">.IJobScheduler</span>]</span><br><span class="line"><span class="number">33</span>	serial: [android<span class="class">.hardware</span><span class="class">.ISerialManager</span>]</span><br><span class="line"><span class="number">34</span>	usb: [android<span class="class">.hardware</span><span class="class">.usb</span><span class="class">.IUsbManager</span>]</span><br><span class="line"><span class="number">35</span>	DockObserver: []</span><br><span class="line"><span class="number">36</span>	audioprofile: [com<span class="class">.mediatek</span><span class="class">.common</span><span class="class">.audioprofile</span><span class="class">.IAudioProfileService</span>]</span><br><span class="line"><span class="number">37</span>	<span class="tag">audio</span>: [android<span class="class">.media</span><span class="class">.IAudioService</span>]</span><br><span class="line"><span class="number">38</span>	wallpaper: [android<span class="class">.app</span><span class="class">.IWallpaperManager</span>]</span><br><span class="line"><span class="number">39</span>	dropbox: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.os</span><span class="class">.IDropBoxManagerService</span>]</span><br><span class="line"><span class="number">40</span>	search_engine: [com<span class="class">.mediatek</span><span class="class">.search</span><span class="class">.ISearchEngineManagerService</span>]</span><br><span class="line"><span class="number">41</span>	search: [android<span class="class">.app</span><span class="class">.ISearchManager</span>]</span><br><span class="line"><span class="number">42</span>	country_detector: [android<span class="class">.location</span><span class="class">.ICountryDetector</span>]</span><br><span class="line"><span class="number">43</span>	location: [android<span class="class">.location</span><span class="class">.ILocationManager</span>]</span><br><span class="line"><span class="number">44</span>	devicestoragemonitor: []</span><br><span class="line"><span class="number">45</span>	notification: [android<span class="class">.app</span><span class="class">.INotificationManager</span>]</span><br><span class="line"><span class="number">46</span>	updatelock: [android<span class="class">.os</span><span class="class">.IUpdateLock</span>]</span><br><span class="line"><span class="number">47</span>	data_shaping: [com<span class="class">.mediatek</span><span class="class">.datashaping</span><span class="class">.IDataShapingManager</span>]</span><br><span class="line"><span class="number">48</span>	servicediscovery: [android<span class="class">.net</span><span class="class">.nsd</span><span class="class">.INsdManager</span>]</span><br><span class="line"><span class="number">49</span>	connectivity: [android<span class="class">.net</span><span class="class">.IConnectivityManager</span>]</span><br><span class="line"><span class="number">50</span>	ethernet: [android<span class="class">.net</span><span class="class">.IEthernetManager</span>]</span><br><span class="line"><span class="number">51</span>	rttmanager: [android<span class="class">.net</span><span class="class">.wifi</span><span class="class">.IRttManager</span>]</span><br><span class="line"><span class="number">52</span>	wifiscanner: [android<span class="class">.net</span><span class="class">.wifi</span><span class="class">.IWifiScanner</span>]</span><br><span class="line"><span class="number">53</span>	wifi: [android<span class="class">.net</span><span class="class">.wifi</span><span class="class">.IWifiManager</span>]</span><br><span class="line"><span class="number">54</span>	wifip2p: [android<span class="class">.net</span><span class="class">.wifi</span><span class="class">.p2p</span><span class="class">.IWifiP2pManager</span>]</span><br><span class="line"><span class="number">55</span>	netpolicy: [android<span class="class">.net</span><span class="class">.INetworkPolicyManager</span>]</span><br><span class="line"><span class="number">56</span>	netstats: [android<span class="class">.net</span><span class="class">.INetworkStatsService</span>]</span><br><span class="line"><span class="number">57</span>	network_score: [android<span class="class">.net</span><span class="class">.INetworkScoreService</span>]</span><br><span class="line"><span class="number">58</span>	textservices: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.textservice</span><span class="class">.ITextServicesManager</span>]</span><br><span class="line"><span class="number">59</span>	network_management: [android<span class="class">.os</span><span class="class">.INetworkManagementService</span>]</span><br><span class="line"><span class="number">60</span>	clipboard: [android<span class="class">.content</span><span class="class">.IClipboard</span>]</span><br><span class="line"><span class="number">61</span>	statusbar: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.statusbar</span><span class="class">.IStatusBarService</span>]</span><br><span class="line"><span class="number">62</span>	device_policy: [android<span class="class">.app</span><span class="class">.admin</span><span class="class">.IDevicePolicyManager</span>]</span><br><span class="line"><span class="number">63</span>	deviceidle: [android<span class="class">.os</span><span class="class">.IDeviceIdleController</span>]</span><br><span class="line"><span class="number">64</span>	persistent_data_block: [android<span class="class">.service</span><span class="class">.persistentdata</span><span class="class">.IPersistentDataBlockService</span>]</span><br><span class="line"><span class="number">65</span>	lock_settings: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.widget</span><span class="class">.ILockSettings</span>]</span><br><span class="line"><span class="number">66</span>	uimode: [android<span class="class">.app</span><span class="class">.IUiModeManager</span>]</span><br><span class="line"><span class="number">67</span>	mount: [IMountService]</span><br><span class="line"><span class="number">68</span>	accessibility: [android<span class="class">.view</span><span class="class">.accessibility</span><span class="class">.IAccessibilityManager</span>]</span><br><span class="line"><span class="number">69</span>	input_method: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.view</span><span class="class">.IInputMethodManager</span>]</span><br><span class="line"><span class="number">70</span>	bluetooth_manager: [android<span class="class">.bluetooth</span><span class="class">.IBluetoothManager</span>]</span><br><span class="line"><span class="number">71</span>	<span class="tag">input</span>: [android<span class="class">.hardware</span><span class="class">.input</span><span class="class">.IInputManager</span>]</span><br><span class="line"><span class="number">72</span>	window: [android<span class="class">.view</span><span class="class">.IWindowManager</span>]</span><br><span class="line"><span class="number">73</span>	alarm: [android<span class="class">.app</span><span class="class">.IAlarmManager</span>]</span><br><span class="line"><span class="number">74</span>	consumer_ir: [android<span class="class">.hardware</span><span class="class">.IConsumerIrService</span>]</span><br><span class="line"><span class="number">75</span>	vibrator: [android<span class="class">.os</span><span class="class">.IVibratorService</span>]</span><br><span class="line"><span class="number">76</span>	mobile: [com<span class="class">.mediatek</span><span class="class">.common</span><span class="class">.mom</span><span class="class">.IMobileManagerService</span>]</span><br><span class="line"><span class="number">77</span>	<span class="attribute">content</span>: [android<span class="class">.content</span><span class="class">.IContentService</span>]</span><br><span class="line"><span class="number">78</span>	account: [android<span class="class">.accounts</span><span class="class">.IAccountManager</span>]</span><br><span class="line"><span class="number">79</span>	media<span class="class">.camera</span><span class="class">.proxy</span>: [android<span class="class">.hardware</span><span class="class">.ICameraServiceProxy</span>]</span><br><span class="line"><span class="number">80</span>	telephony<span class="class">.registry</span>: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.telephony</span><span class="class">.ITelephonyRegistry</span>]</span><br><span class="line"><span class="number">81</span>	scheduling_policy: [android<span class="class">.os</span><span class="class">.ISchedulingPolicyService</span>]</span><br><span class="line"><span class="number">82</span>	webviewupdate: [android<span class="class">.webkit</span><span class="class">.IWebViewUpdateService</span>]</span><br><span class="line"><span class="number">83</span>	usagestats: [android<span class="class">.app</span><span class="class">.usage</span><span class="class">.IUsageStatsManager</span>]</span><br><span class="line"><span class="number">84</span>	battery: []</span><br><span class="line"><span class="number">85</span>	sensorservice: [android<span class="class">.gui</span><span class="class">.SensorServer</span>]</span><br><span class="line"><span class="number">86</span>	anrmanager: [android<span class="class">.app</span><span class="class">.IANRManager</span>]</span><br><span class="line"><span class="number">87</span>	processinfo: [android<span class="class">.os</span><span class="class">.IProcessInfoService</span>]</span><br><span class="line"><span class="number">88</span>	permission: [android<span class="class">.os</span><span class="class">.IPermissionController</span>]</span><br><span class="line"><span class="number">89</span>	cpuinfo: []</span><br><span class="line"><span class="number">90</span>	dbinfo: []</span><br><span class="line"><span class="number">91</span>	gfxinfo: []</span><br><span class="line"><span class="number">92</span>	meminfo: []</span><br><span class="line"><span class="number">93</span>	procstats: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.app</span><span class="class">.IProcessStats</span>]</span><br><span class="line"><span class="number">94</span>	activity: [android<span class="class">.app</span><span class="class">.IActivityManager</span>]</span><br><span class="line"><span class="number">95</span>	user: [android<span class="class">.os</span><span class="class">.IUserManager</span>]</span><br><span class="line"><span class="number">96</span>	package: [android<span class="class">.content</span><span class="class">.pm</span><span class="class">.IPackageManager</span>]</span><br><span class="line"><span class="number">97</span>	recovery: [com<span class="class">.mediatek</span><span class="class">.recovery</span><span class="class">.IRecoveryManagerService</span>]</span><br><span class="line"><span class="number">98</span>	<span class="attribute">display</span>: [android<span class="class">.hardware</span><span class="class">.display</span><span class="class">.IDisplayManager</span>]</span><br><span class="line"><span class="number">99</span>	power: [android<span class="class">.os</span><span class="class">.IPowerManager</span>]</span><br><span class="line"><span class="number">100</span>	appops: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.app</span><span class="class">.IAppOpsService</span>]</span><br><span class="line"><span class="number">101</span>	batterystats: [com<span class="class">.android</span><span class="class">.internal</span><span class="class">.app</span><span class="class">.IBatteryStats</span>]</span><br><span class="line"><span class="number">102</span>	media<span class="class">.mmsdk</span>: [com<span class="class">.mediatek</span><span class="class">.mmsdk</span><span class="class">.IMMSdkService</span>]</span><br><span class="line"><span class="number">103</span>	media<span class="class">.radio</span>: [android<span class="class">.hardware</span><span class="class">.IRadioService</span>]</span><br><span class="line"><span class="number">104</span>	media<span class="class">.sound_trigger_hw</span>: [android<span class="class">.hardware</span><span class="class">.ISoundTriggerHwService</span>]</span><br><span class="line"><span class="number">105</span>	media<span class="class">.audio_policy</span>: [android<span class="class">.media</span><span class="class">.IAudioPolicyService</span>]</span><br><span class="line"><span class="number">106</span>	media<span class="class">.camera</span>: [android<span class="class">.hardware</span><span class="class">.ICameraService</span>]</span><br><span class="line"><span class="number">107</span>	user<span class="class">.xposed</span><span class="class">.app</span>: [com<span class="class">.eebbk</span><span class="class">.studyos</span><span class="class">.alpaca</span><span class="class">.IXposedService</span>]</span><br><span class="line"><span class="number">108</span>	user<span class="class">.xposed</span><span class="class">.system</span>: [com<span class="class">.eebbk</span><span class="class">.studyos</span><span class="class">.alpaca</span><span class="class">.IXposedService</span>]</span><br><span class="line"><span class="number">109</span>	media<span class="class">.VTS</span>: [android<span class="class">.hardware</span><span class="class">.IVTService</span>]</span><br><span class="line"><span class="number">110</span>	SurfaceFlinger: [android<span class="class">.ui</span><span class="class">.ISurfaceComposer</span>]</span><br><span class="line"><span class="number">111</span>	drm<span class="class">.drmManager</span>: [drm.IDrmManagerService]</span><br><span class="line"><span class="number">112</span>	memory_dumper: [android<span class="class">.memory</span><span class="class">.IMemoryDumper</span>]</span><br><span class="line"><span class="number">113</span>	media<span class="class">.resource_manager</span>: [android<span class="class">.media</span><span class="class">.IResourceManagerService</span>]</span><br><span class="line"><span class="number">114</span>	media<span class="class">.player</span>: [android<span class="class">.media</span><span class="class">.IMediaPlayerService</span>]</span><br><span class="line"><span class="number">115</span>	media<span class="class">.audio_flinger</span>: [android<span class="class">.media</span><span class="class">.IAudioFlinger</span>]</span><br><span class="line"><span class="number">116</span>	program_binary: []</span><br><span class="line"><span class="number">117</span>	android<span class="class">.security</span><span class="class">.keystore</span>: [android<span class="class">.security</span><span class="class">.IKeystoreService</span>]</span><br><span class="line"><span class="number">118</span>	batteryproperties: [android<span class="class">.os</span><span class="class">.IBatteryPropertiesRegistrar</span>]</span><br><span class="line"><span class="number">119</span>	android<span class="class">.service</span><span class="class">.gatekeeper</span><span class="class">.IGateKeeperService</span>: []</span><br><span class="line"><span class="number">120</span>	GuiExtService: [GuiExtService]</span><br><span class="line"><span class="number">121</span>	DmAgent: []</span><br><span class="line"><span class="number">122</span>	PQ: [PQService]</span><br><span class="line"><span class="number">123</span>	mtk<span class="class">.codecservice</span>: []</span><br><span class="line"><span class="number">124</span>	PPLAgent: []</span><br><span class="line"><span class="number">125</span>	NvRAMAgent: [NvRAMAgent]</span><br></pre></td></tr></table></figure>
<h3 id="dumpsys-activity"><a href="#dumpsys-activity" class="headerlink" title="dumpsys activity"></a>dumpsys activity</h3><p>通过命令<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">dumpsys</span> activity -h</span><br></pre></td></tr></table></figure></p>
<p>可查看所有参数<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">shell@M1000:/ $ dumpsys activity -h                                            </span><br><span class="line">Activity manager dump options:</span><br><span class="line">  [-a] [-c] [-p package] [-h] [cmd] ...</span><br><span class="line">  cmd may be one of:</span><br><span class="line">    a[ctivities]: activity stack <span class="keyword">state</span> //activity 栈状态</span><br><span class="line">    r[recents]: recent activities <span class="keyword">state</span> //最近使用Activity状态</span><br><span class="line">    b[roadcasts] [PACKAGE_NAME] [history [-s]]: broadcast <span class="keyword">state</span> //广播状态</span><br><span class="line">    i[ntents] [PACKAGE_NAME]: pending intent <span class="keyword">state</span> // Pending intent状态</span><br><span class="line">    p[rocesses] [PACKAGE_NAME]: process <span class="keyword">state</span> //进程状态</span><br><span class="line">    o[om]: <span class="keyword">out</span> of memory management // OOM信息</span><br><span class="line">    perm[issions]: URI permission grant <span class="keyword">state</span> //授权状态</span><br><span class="line">    prov[iders] [COMP_SPEC ...]: content provider <span class="keyword">state</span> //ContentProvider状态</span><br><span class="line">    provider [COMP_SPEC]: provider client-side <span class="keyword">state</span> //ContentProvider(客户端)状态</span><br><span class="line">    s[ervices] [COMP_SPEC ...]: service <span class="keyword">state</span> //服务状态</span><br><span class="line">    as[sociations]: tracked app associations</span><br><span class="line">    service [COMP_SPEC]: service client-side <span class="keyword">state</span> //服务（客户端）状态</span><br><span class="line">    package [PACKAGE_NAME]: <span class="literal">all</span> <span class="keyword">state</span> related <span class="keyword">to</span> given package //所有与给予包名相关的状态</span><br><span class="line">    <span class="literal">all</span>: dump <span class="literal">all</span> activities //所有的activities信息</span><br><span class="line">    top: dump the top activity //栈顶activity信息</span><br><span class="line">    write: write <span class="literal">all</span> pending <span class="keyword">state</span> <span class="keyword">to</span> storage //状态持久化到存储</span><br><span class="line">    track-associations: enable association tracking //</span><br><span class="line">    untrack-associations: disable and clear association tracking</span><br><span class="line">  cmd may also be a COMP_SPEC <span class="keyword">to</span> dump activities.</span><br><span class="line">  COMP_SPEC may be a component name (com.foo/.myApp),</span><br><span class="line">    a partial substring <span class="keyword">in</span> a component name, a</span><br><span class="line">    hex object identifier.</span><br><span class="line">  -a: include <span class="literal">all</span> available server <span class="keyword">state</span>. //列出所有可用的服务状态</span><br><span class="line">  -c: include client <span class="keyword">state</span>. //列出客户端状态</span><br><span class="line">  -p: <span class="keyword">limit</span> output <span class="keyword">to</span> given package. //过滤，只显示该包名</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android Debug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[am命令]]></title>
      <url>http://codingtrip.com/2016/06/23/0012-adb-shell-am/</url>
      <content type="html"><![CDATA[<h2 id="什么是am命令"><a href="#什么是am命令" class="headerlink" title="什么是am命令"></a>什么是am命令</h2><p>am也是Android自带的一个脚本命令，位于：/system/bin/目录下，通过cat命令可查看其内容：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shell@M1000:/system/bin $ cat am                                               </span><br><span class="line"><span class="shebang">#!/system/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Script to start "am" on the device, which has a very rudimentary</span></span><br><span class="line"><span class="comment"># shell.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">base=/system</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$base</span>/framework/am.jar</span><br><span class="line"><span class="built_in">exec</span> app_process <span class="variable">$base</span>/bin com.android.commands.am.Am <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>通过终端输入adb shell　am可查看所有命令详情：<br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">lcg@lcg-work-pc:~$ adb shell am</span><br><span class="line">usage: am [subcommand] [options]</span><br><span class="line">usage: am start [-D] [-W] [-P &lt;<span class="keyword">FILE</span>&gt;] [<span class="comment">--start-profiler &lt;FILE&gt;]</span></span><br><span class="line">               [<span class="comment">--sampling INTERVAL] [-R COUNT] [-S] [--opengl-trace]</span></span><br><span class="line">               [<span class="comment">--user &lt;USER_ID&gt; | current] &lt;INTENT&gt;</span></span><br><span class="line">       am startservice [<span class="comment">--user &lt;USER_ID&gt; | current] &lt;INTENT&gt; //开启服务</span></span><br><span class="line">       am stopservice [<span class="comment">--user &lt;USER_ID&gt; | current] &lt;INTENT&gt; //关闭服务</span></span><br><span class="line">       am <span class="keyword">force</span>-stop [<span class="comment">--user &lt;USER_ID&gt; | all | current] &lt;PACKAGE&gt; //强杀进程</span></span><br><span class="line">       am kill [<span class="comment">--user &lt;USER_ID&gt; | all | current] &lt;PACKAGE&gt; //强杀进程</span></span><br><span class="line">       am kill-<span class="keyword">all</span> //强杀所有后台进程</span><br><span class="line">       am broadcast [<span class="comment">--user &lt;USER_ID&gt; | all | current] &lt;INTENT&gt; //发送广播</span></span><br><span class="line">       am instrument [-r] [-e &lt;NAME&gt; &lt;VALUE&gt;] [-p &lt;<span class="keyword">FILE</span>&gt;] [-w]</span><br><span class="line">               [<span class="comment">--user &lt;USER_ID&gt; | current]</span></span><br><span class="line">               [<span class="comment">--no-window-animation] [--abi &lt;ABI&gt;] &lt;COMPONENT&gt;</span></span><br><span class="line">       am profile start [<span class="comment">--user &lt;USER_ID&gt; current] [--sampling INTERVAL] &lt;PROCESS&gt; &lt;FILE&gt;</span></span><br><span class="line">       am profile stop [<span class="comment">--user &lt;USER_ID&gt; current] [&lt;PROCESS&gt;]</span></span><br><span class="line">       am dumpheap [<span class="comment">--user &lt;USER_ID&gt; current] [-n] &lt;PROCESS&gt; &lt;FILE&gt;</span></span><br><span class="line">       am set-debug-app [-w] [<span class="comment">--persistent] &lt;PACKAGE&gt;</span></span><br><span class="line">       am clear-debug-app</span><br><span class="line">       am set-watch-heap &lt;<span class="keyword">PROCESS</span>&gt; &lt;MEM-LIMIT&gt;</span><br><span class="line">       am clear-watch-heap</span><br><span class="line">       am monitor [<span class="comment">--gdb &lt;port&gt;]</span></span><br><span class="line">       am hang [<span class="comment">--allow-restart]</span></span><br><span class="line">       am restart //重启机器</span><br><span class="line">       am idle-maintenance</span><br><span class="line">       am screen-compat [<span class="keyword">on</span>|off] &lt;<span class="keyword">PACKAGE</span>&gt;</span><br><span class="line">       am <span class="keyword">package</span>-importance &lt;<span class="keyword">PACKAGE</span>&gt;</span><br><span class="line">       am <span class="keyword">to</span>-uri [INTENT]</span><br><span class="line">       am <span class="keyword">to</span>-intent-uri [INTENT]</span><br><span class="line">       am <span class="keyword">to</span>-app-uri [INTENT]</span><br><span class="line">       am switch-user &lt;USER_ID&gt;</span><br><span class="line">       am start-user &lt;USER_ID&gt;</span><br><span class="line">       am stop-user [-w] &lt;USER_ID&gt;</span><br><span class="line">       am stack start &lt;DISPLAY_ID&gt; &lt;INTENT&gt;</span><br><span class="line">       am stack movetask &lt;TASK_ID&gt; &lt;STACK_ID&gt; [true|false]</span><br><span class="line">       am stack resize &lt;STACK_ID&gt; &lt;LEFT,TOP,RIGHT,BOTTOM&gt;</span><br><span class="line">       am stack split &lt;STACK_ID&gt; &lt;v|h&gt; [INTENT]</span><br><span class="line">       am stack list</span><br><span class="line">       am stack info &lt;STACK_ID&gt;</span><br><span class="line">       am task lock &lt;TASK_ID&gt;</span><br><span class="line">       am task lock stop</span><br><span class="line">       am task resizeable &lt;TASK_ID&gt; [true|false]</span><br><span class="line">       am task resize &lt;TASK_ID&gt; &lt;LEFT,TOP,RIGHT,BOTTOM&gt;</span><br><span class="line">       am get-config</span><br><span class="line">       am set-inactive [<span class="comment">--user &lt;USER_ID&gt;] &lt;PACKAGE&gt; true|false</span></span><br><span class="line">       am get-inactive [<span class="comment">--user &lt;USER_ID&gt;] &lt;PACKAGE&gt;</span></span><br><span class="line">       am send-trim-memory [<span class="comment">--user &lt;USER_ID&gt;] &lt;PROCESS&gt;</span></span><br><span class="line">               [HIDDEN|RUNNING_MODERATE|BACKGROUND|RUNNING_LOW|MODERATE|RUNNING_CRITICAL|COMPLETE]</span><br><span class="line"></span><br><span class="line">am start: start an Activity.  Options are:</span><br><span class="line">    -D: enable debugging</span><br><span class="line">    -W: <span class="keyword">wait</span> <span class="keyword">for</span> launch <span class="keyword">to</span> complete</span><br><span class="line">    <span class="comment">--start-profiler &lt;FILE&gt;: start profiler and send results to &lt;FILE&gt;</span></span><br><span class="line">    <span class="comment">--sampling INTERVAL: use sample profiling with INTERVAL microseconds</span></span><br><span class="line">        between samples (<span class="keyword">use</span> <span class="keyword">with</span> <span class="comment">--start-profiler)</span></span><br><span class="line">    -P &lt;<span class="keyword">FILE</span>&gt;: like above, but profiling stops <span class="keyword">when</span> app goes idle</span><br><span class="line">    -R: repeat the activity launch &lt;COUNT&gt; times.  Prior <span class="keyword">to</span> each repeat,</span><br><span class="line">        the top activity will be finished.</span><br><span class="line">    -S: <span class="keyword">force</span> stop the target app before starting the activity</span><br><span class="line">    <span class="comment">--opengl-trace: enable tracing of OpenGL functions</span></span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | current: Specify which user to run as; if not</span></span><br><span class="line">        specified <span class="keyword">then</span> run as the current user.</span><br><span class="line"></span><br><span class="line">am startservice: start a Service.  Options are:</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | current: Specify which user to run as; if not</span></span><br><span class="line">        specified <span class="keyword">then</span> run as the current user.</span><br><span class="line"></span><br><span class="line">am stopservice: stop a Service.  Options are:</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | current: Specify which user to run as; if not</span></span><br><span class="line">        specified <span class="keyword">then</span> run as the current user.</span><br><span class="line"></span><br><span class="line">am <span class="keyword">force</span>-stop: <span class="keyword">force</span> stop everything associated <span class="keyword">with</span> &lt;<span class="keyword">PACKAGE</span>&gt;.</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | all | current: Specify user to force stop;</span></span><br><span class="line">        <span class="keyword">all</span> users <span class="keyword">if</span> <span class="keyword">not</span> specified.</span><br><span class="line"></span><br><span class="line">am kill: Kill <span class="keyword">all</span> processes associated <span class="keyword">with</span> &lt;<span class="keyword">PACKAGE</span>&gt;.  Only kills.</span><br><span class="line">  processes that are safe <span class="keyword">to</span> kill <span class="comment">-- that is, will not impact the user</span></span><br><span class="line">  experience.</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | all | current: Specify user whose processes to kill;</span></span><br><span class="line">        <span class="keyword">all</span> users <span class="keyword">if</span> <span class="keyword">not</span> specified.</span><br><span class="line"></span><br><span class="line">am kill-<span class="keyword">all</span>: Kill <span class="keyword">all</span> background processes.</span><br><span class="line"></span><br><span class="line">am broadcast: send a broadcast Intent.  Options are:</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | all | current: Specify which user to send to; if not</span></span><br><span class="line">        specified <span class="keyword">then</span> send <span class="keyword">to</span> <span class="keyword">all</span> users.</span><br><span class="line">    <span class="comment">--receiver-permission &lt;PERMISSION&gt;: Require receiver to hold permission.</span></span><br><span class="line"></span><br><span class="line">am instrument: start an Instrumentation.  Typically this target &lt;<span class="keyword">COMPONENT</span>&gt;</span><br><span class="line">  <span class="keyword">is</span> the form &lt;TEST_PACKAGE&gt;/&lt;RUNNER_CLASS&gt;.  Options are:</span><br><span class="line">    -r: print raw results (otherwise decode REPORT_KEY_STREAMRESULT).  <span class="keyword">Use</span> <span class="keyword">with</span></span><br><span class="line">        [-e perf true] <span class="keyword">to</span> <span class="keyword">generate</span> raw output <span class="keyword">for</span> performance measurements.</span><br><span class="line">    -e &lt;NAME&gt; &lt;VALUE&gt;: set argument &lt;NAME&gt; <span class="keyword">to</span> &lt;VALUE&gt;.  <span class="keyword">For</span> test runners a</span><br><span class="line">        common form <span class="keyword">is</span> [-e &lt;testrunner_flag&gt; &lt;value&gt;[,&lt;value&gt;...]].</span><br><span class="line">    -p &lt;<span class="keyword">FILE</span>&gt;: write profiling data <span class="keyword">to</span> &lt;<span class="keyword">FILE</span>&gt;</span><br><span class="line">    -w: <span class="keyword">wait</span> <span class="keyword">for</span> instrumentation <span class="keyword">to</span> finish before returning.  Required <span class="keyword">for</span></span><br><span class="line">        test runners.</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | current: Specify user instrumentation runs in;</span></span><br><span class="line">        current user <span class="keyword">if</span> <span class="keyword">not</span> specified.</span><br><span class="line">    <span class="comment">--no-window-animation: turn off window animations while running.</span></span><br><span class="line">    <span class="comment">--abi &lt;ABI&gt;: Launch the instrumented process with the selected ABI.</span></span><br><span class="line">        This assumes that the <span class="keyword">process</span> supports the selected ABI.</span><br><span class="line"></span><br><span class="line">am profile: start <span class="keyword">and</span> stop profiler <span class="keyword">on</span> a <span class="keyword">process</span>.  The given &lt;<span class="keyword">PROCESS</span>&gt; argument</span><br><span class="line">  may be either a <span class="keyword">process</span> name <span class="keyword">or</span> pid.  Options are:</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | current: When supplying a process name,</span></span><br><span class="line">        specify user <span class="keyword">of</span> <span class="keyword">process</span> <span class="keyword">to</span> profile; uses current user <span class="keyword">if</span> <span class="keyword">not</span> specified.</span><br><span class="line"></span><br><span class="line">am dumpheap: dump the heap <span class="keyword">of</span> a <span class="keyword">process</span>.  The given &lt;<span class="keyword">PROCESS</span>&gt; argument may</span><br><span class="line">  be either a <span class="keyword">process</span> name <span class="keyword">or</span> pid.  Options are:</span><br><span class="line">    -n: dump native heap instead <span class="keyword">of</span> managed heap</span><br><span class="line">    <span class="comment">--user &lt;USER_ID&gt; | current: When supplying a process name,</span></span><br><span class="line">        specify user <span class="keyword">of</span> <span class="keyword">process</span> <span class="keyword">to</span> dump; uses current user <span class="keyword">if</span> <span class="keyword">not</span> specified.</span><br><span class="line"></span><br><span class="line">am set-debug-app: set application &lt;<span class="keyword">PACKAGE</span>&gt; <span class="keyword">to</span> debug.  Options are:</span><br><span class="line">    -w: <span class="keyword">wait</span> <span class="keyword">for</span> debugger <span class="keyword">when</span> application starts</span><br><span class="line">    <span class="comment">--persistent: retain this value</span></span><br><span class="line"></span><br><span class="line">am clear-debug-app: clear the previously set-debug-app.</span><br><span class="line"></span><br><span class="line">am set-watch-heap: start monitoring pss size <span class="keyword">of</span> &lt;<span class="keyword">PROCESS</span>&gt;, <span class="keyword">if</span> it <span class="keyword">is</span> at <span class="keyword">or</span></span><br><span class="line">    above &lt;HEAP-LIMIT&gt; <span class="keyword">then</span> a heap dump <span class="keyword">is</span> collected <span class="keyword">for</span> the user <span class="keyword">to</span> <span class="keyword">report</span></span><br><span class="line"></span><br><span class="line">am clear-watch-heap: clear the previously set-watch-heap.</span><br><span class="line"></span><br><span class="line">am bug-<span class="keyword">report</span>: request bug <span class="keyword">report</span> generation; will launch UI</span><br><span class="line">    <span class="keyword">when</span> done <span class="keyword">to</span> <span class="keyword">select</span> where it should be delivered.</span><br><span class="line"></span><br><span class="line">am monitor: start monitoring <span class="keyword">for</span> crashes <span class="keyword">or</span> ANRs.</span><br><span class="line">    <span class="comment">--gdb: start gdbserv on the given port at crash/ANR</span></span><br><span class="line"></span><br><span class="line">am hang: hang the system.</span><br><span class="line">    <span class="comment">--allow-restart: allow watchdog to perform normal system restart</span></span><br><span class="line"></span><br><span class="line">am restart: restart the user-space system.</span><br><span class="line"></span><br><span class="line">am idle-maintenance: perform idle maintenance now.</span><br><span class="line"></span><br><span class="line">am screen-compat: control screen compatibility mode <span class="keyword">of</span> &lt;<span class="keyword">PACKAGE</span>&gt;.</span><br><span class="line"></span><br><span class="line">am <span class="keyword">package</span>-importance: print current importance <span class="keyword">of</span> &lt;<span class="keyword">PACKAGE</span>&gt;.</span><br><span class="line"></span><br><span class="line">am <span class="keyword">to</span>-uri: print the given Intent specification as a URI.</span><br><span class="line"></span><br><span class="line">am <span class="keyword">to</span>-intent-uri: print the given Intent specification as an intent: URI.</span><br><span class="line"></span><br><span class="line">am <span class="keyword">to</span>-app-uri: print the given Intent specification as an android-app: URI.</span><br><span class="line"></span><br><span class="line">am switch-user: switch <span class="keyword">to</span> put USER_ID <span class="keyword">in</span> the foreground, starting</span><br><span class="line">  execution <span class="keyword">of</span> that user <span class="keyword">if</span> it <span class="keyword">is</span> currently stopped.</span><br><span class="line"></span><br><span class="line">am start-user: start USER_ID <span class="keyword">in</span> background <span class="keyword">if</span> it <span class="keyword">is</span> currently stopped,</span><br><span class="line">  <span class="keyword">use</span> switch-user <span class="keyword">if</span> you want <span class="keyword">to</span> start the user <span class="keyword">in</span> foreground.</span><br><span class="line"></span><br><span class="line">am stop-user: stop execution <span class="keyword">of</span> USER_ID, <span class="keyword">not</span> allowing it <span class="keyword">to</span> run any</span><br><span class="line">  code <span class="keyword">until</span> a later explicit start <span class="keyword">or</span> switch <span class="keyword">to</span> it.</span><br><span class="line">  -w: <span class="keyword">wait</span> <span class="keyword">for</span> stop-user <span class="keyword">to</span> complete.</span><br><span class="line"></span><br><span class="line">am stack start: start a <span class="keyword">new</span> activity <span class="keyword">on</span> &lt;DISPLAY_ID&gt; using &lt;INTENT&gt;.</span><br><span class="line"></span><br><span class="line">am stack movetask: move &lt;TASK_ID&gt; from its current stack <span class="keyword">to</span> the top (true) <span class="keyword">or</span>   bottom (false) <span class="keyword">of</span> &lt;STACK_ID&gt;.</span><br><span class="line"></span><br><span class="line">am stack resize: change &lt;STACK_ID&gt; size <span class="keyword">and</span> position <span class="keyword">to</span> &lt;LEFT,TOP,RIGHT,BOTTOM&gt;.</span><br><span class="line"></span><br><span class="line">am stack split: split &lt;STACK_ID&gt; into <span class="number">2</span> stacks &lt;v&gt;ertically <span class="keyword">or</span> &lt;h&gt;orizontally</span><br><span class="line">   starting the <span class="keyword">new</span> stack <span class="keyword">with</span> [INTENT] <span class="keyword">if</span> specified. <span class="keyword">If</span> [INTENT] isn<span class="attribute">'t</span></span><br><span class="line">   specified <span class="keyword">and</span> the current stack has more than one task, <span class="keyword">then</span> the top task</span><br><span class="line">   <span class="keyword">of</span> the current task will be moved <span class="keyword">to</span> the <span class="keyword">new</span> stack. Command will also <span class="keyword">force</span></span><br><span class="line">   <span class="keyword">all</span> current tasks <span class="keyword">in</span> both stacks <span class="keyword">to</span> be resizeable.</span><br><span class="line"></span><br><span class="line">am stack list: list <span class="keyword">all</span> <span class="keyword">of</span> the activity stacks <span class="keyword">and</span> their sizes.</span><br><span class="line"></span><br><span class="line">am stack info: display the information about activity stack &lt;STACK_ID&gt;.</span><br><span class="line"></span><br><span class="line">am task lock: bring &lt;TASK_ID&gt; <span class="keyword">to</span> the front <span class="keyword">and</span> don<span class="attribute">'t</span> allow other tasks <span class="keyword">to</span> run.</span><br><span class="line"></span><br><span class="line">am task lock stop: <span class="keyword">end</span> the current task lock.</span><br><span class="line"></span><br><span class="line">am task resizeable: change <span class="keyword">if</span> &lt;TASK_ID&gt; <span class="keyword">is</span> resizeable (true) <span class="keyword">or</span> <span class="keyword">not</span> (false).</span><br><span class="line"></span><br><span class="line">am task resize: makes sure &lt;TASK_ID&gt; <span class="keyword">is</span> <span class="keyword">in</span> a stack <span class="keyword">with</span> the specified bounds.</span><br><span class="line">   Forces the task <span class="keyword">to</span> be resizeable <span class="keyword">and</span> creates a stack <span class="keyword">if</span> no existing stack</span><br><span class="line">   has the specified bounds.</span><br><span class="line"></span><br><span class="line">am get-config: retrieve the <span class="keyword">configuration</span> <span class="keyword">and</span> any recent configurations</span><br><span class="line">  <span class="keyword">of</span> the device.</span><br><span class="line"></span><br><span class="line">am set-inactive: sets the inactive state <span class="keyword">of</span> an app.</span><br><span class="line"></span><br><span class="line">am get-inactive: returns the inactive state <span class="keyword">of</span> an app.</span><br><span class="line"></span><br><span class="line">am send-trim-memory: Send a memory trim event <span class="keyword">to</span> a &lt;<span class="keyword">PROCESS</span>&gt;.</span><br><span class="line"></span><br><span class="line">&lt;INTENT&gt; specifications include these flags <span class="keyword">and</span> arguments:</span><br><span class="line">    [-a &lt;ACTION&gt;] [-d &lt;DATA_URI&gt;] [-t &lt;MIME_TYPE&gt;]</span><br><span class="line">    [-c &lt;CATEGORY&gt; [-c &lt;CATEGORY&gt;] ...]</span><br><span class="line">    [-e|<span class="comment">--es &lt;EXTRA_KEY&gt; &lt;EXTRA_STRING_VALUE&gt; ...]</span></span><br><span class="line">    [<span class="comment">--esn &lt;EXTRA_KEY&gt; ...]</span></span><br><span class="line">    [<span class="comment">--ez &lt;EXTRA_KEY&gt; &lt;EXTRA_BOOLEAN_VALUE&gt; ...]</span></span><br><span class="line">    [<span class="comment">--ei &lt;EXTRA_KEY&gt; &lt;EXTRA_INT_VALUE&gt; ...]</span></span><br><span class="line">    [<span class="comment">--el &lt;EXTRA_KEY&gt; &lt;EXTRA_LONG_VALUE&gt; ...]</span></span><br><span class="line">    [<span class="comment">--ef &lt;EXTRA_KEY&gt; &lt;EXTRA_FLOAT_VALUE&gt; ...]</span></span><br><span class="line">    [<span class="comment">--eu &lt;EXTRA_KEY&gt; &lt;EXTRA_URI_VALUE&gt; ...]</span></span><br><span class="line">    [<span class="comment">--ecn &lt;EXTRA_KEY&gt; &lt;EXTRA_COMPONENT_NAME_VALUE&gt;]</span></span><br><span class="line">    [<span class="comment">--eia &lt;EXTRA_KEY&gt; &lt;EXTRA_INT_VALUE&gt;[,&lt;EXTRA_INT_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as <span class="typename">Integer</span>[])</span><br><span class="line">    [<span class="comment">--eial &lt;EXTRA_KEY&gt; &lt;EXTRA_INT_VALUE&gt;[,&lt;EXTRA_INT_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as List&lt;<span class="typename">Integer</span>&gt;)</span><br><span class="line">    [<span class="comment">--ela &lt;EXTRA_KEY&gt; &lt;EXTRA_LONG_VALUE&gt;[,&lt;EXTRA_LONG_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as Long[])</span><br><span class="line">    [<span class="comment">--elal &lt;EXTRA_KEY&gt; &lt;EXTRA_LONG_VALUE&gt;[,&lt;EXTRA_LONG_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as List&lt;Long&gt;)</span><br><span class="line">    [<span class="comment">--efa &lt;EXTRA_KEY&gt; &lt;EXTRA_FLOAT_VALUE&gt;[,&lt;EXTRA_FLOAT_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as Float[])</span><br><span class="line">    [<span class="comment">--efal &lt;EXTRA_KEY&gt; &lt;EXTRA_FLOAT_VALUE&gt;[,&lt;EXTRA_FLOAT_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as List&lt;Float&gt;)</span><br><span class="line">    [<span class="comment">--esa &lt;EXTRA_KEY&gt; &lt;EXTRA_STRING_VALUE&gt;[,&lt;EXTRA_STRING_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as <span class="typename">String</span>[]; <span class="keyword">to</span> embed a comma into a <span class="typename">string</span>,</span><br><span class="line">         escape it using <span class="string">"\,"</span>)</span><br><span class="line">    [<span class="comment">--esal &lt;EXTRA_KEY&gt; &lt;EXTRA_STRING_VALUE&gt;[,&lt;EXTRA_STRING_VALUE...]]</span></span><br><span class="line">        (mutiple extras passed as List&lt;<span class="typename">String</span>&gt;; <span class="keyword">to</span> embed a comma into a <span class="typename">string</span>,</span><br><span class="line">         escape it using <span class="string">"\,"</span>)</span><br><span class="line">    [<span class="comment">--grant-read-uri-permission] [--grant-write-uri-permission]</span></span><br><span class="line">    [<span class="comment">--grant-persistable-uri-permission] [--grant-prefix-uri-permission]</span></span><br><span class="line">    [<span class="comment">--debug-log-resolution] [--exclude-stopped-packages]</span></span><br><span class="line">    [<span class="comment">--include-stopped-packages]</span></span><br><span class="line">    [<span class="comment">--activity-brought-to-front] [--activity-clear-top]</span></span><br><span class="line">    [<span class="comment">--activity-clear-when-task-reset] [--activity-exclude-from-recents]</span></span><br><span class="line">    [<span class="comment">--activity-launched-from-history] [--activity-multiple-task]</span></span><br><span class="line">    [<span class="comment">--activity-no-animation] [--activity-no-history]</span></span><br><span class="line">    [<span class="comment">--activity-no-user-action] [--activity-previous-is-top]</span></span><br><span class="line">    [<span class="comment">--activity-reorder-to-front] [--activity-reset-task-if-needed]</span></span><br><span class="line">    [<span class="comment">--activity-single-top] [--activity-clear-task]</span></span><br><span class="line">    [<span class="comment">--activity-task-on-home]</span></span><br><span class="line">    [<span class="comment">--receiver-registered-only] [--receiver-replace-pending]</span></span><br><span class="line">    [<span class="comment">--selector]</span></span><br><span class="line">    [&lt;URI&gt; | &lt;<span class="keyword">PACKAGE</span>&gt; | &lt;<span class="keyword">COMPONENT</span>&gt;]</span><br></pre></td></tr></table></figure></p>
<p>通用的使用方法是： am +　子命令　＋ 参数</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android Debug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[svc命令]]></title>
      <url>http://codingtrip.com/2016/06/22/0011-adb-shell-svc/</url>
      <content type="html"><![CDATA[<h2 id="什么是svc命令"><a href="#什么是svc命令" class="headerlink" title="什么是svc命令"></a>什么是svc命令</h2><p>svc是Android的一个脚本命令，在/system/bin目录下，我们通过cat命令可查看其详细信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">caigandeMacBook-Pro:~ lcg$ adb shell cat /system/bin/svc</span><br><span class="line"><span class="comment"># Script to start "am" on the device, which has a very rudimentary</span></span><br><span class="line"><span class="comment"># shell.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">base=/system</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$base</span>/framework/svc.jar</span><br><span class="line"><span class="built_in">exec</span> app_process <span class="variable">$base</span>/bin com.android.commands.svc.Svc $*</span><br></pre></td></tr></table></figure></p>
<p>通过-h参数可查看所有命令：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">caigandeMacBook-Pro:~ lcg$ adb shell svc -h</span><br><span class="line">Available commands:</span><br><span class="line">    <span class="operator"><span class="keyword">help</span>     <span class="keyword">Show</span> information about the subcommands</span><br><span class="line">    <span class="keyword">power</span>    Control the <span class="keyword">power</span> manager</span><br><span class="line">    <span class="keyword">data</span>     Control mobile <span class="keyword">data</span> connectivity</span><br><span class="line">    wifi     Control the Wi-Fi manager</span><br><span class="line">    usb      Control Usb state</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h3 id="svc-power-控制电源管理"><a href="#svc-power-控制电源管理" class="headerlink" title="svc power:控制电源管理"></a>svc power:控制电源管理</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">shell</span>@mx2:/ $ svc power -h</span><br><span class="line">Control <span class="operator">the</span> power manager</span><br><span class="line"></span><br><span class="line">usage: svc power stayon [<span class="constant">true</span>|<span class="constant">false</span>|usb|ac|wireless]</span><br><span class="line">         Set <span class="operator">the</span> <span class="string">'keep awake while plugged in'</span> setting.</span><br><span class="line">       svc power reboot [reason]</span><br><span class="line">         Perform <span class="operator">a</span> runtime shutdown <span class="operator">and</span> reboot device <span class="operator">with</span> specified reason.</span><br><span class="line">       svc power shutdown</span><br><span class="line">         Perform <span class="operator">a</span> runtime shutdown <span class="operator">and</span> power off <span class="operator">the</span> device.</span><br></pre></td></tr></table></figure>
<p><strong>svc power stayon [true|false|usb|ac|wireless]</strong>: 设置保持唤醒状态<br>1.true:常亮，相当于设置了所有标记(usb, ac, wireless)<br>2.false：清除所有标记<br>3.usb:插入usb时常亮<br>4.ac:充电时常亮<br>5.wireless：无线充电时常亮<br>当设置usb/ac/wireless其中一个标记时，会清除其余标记  </p>
<p><strong>svc power reboot [reason]</strong>: 设置设备在特定条件下关机并重启  </p>
<p><strong>svc power shutdown</strong>: 设置设备关机  </p>
<h3 id="svc-data-控制设备数据连接"><a href="#svc-data-控制设备数据连接" class="headerlink" title="svc data:控制设备数据连接"></a>svc data:控制设备数据连接</h3><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">shell</span>@mx2:/ $ svc <span class="typedef"><span class="keyword">data</span> -h</span></span><br><span class="line"><span class="type">Control</span> mobile <span class="typedef"><span class="keyword">data</span> connectivity</span></span><br><span class="line"></span><br><span class="line"><span class="title">usage</span>: svc <span class="typedef"><span class="keyword">data</span> [enable|disable]</span></span><br><span class="line">         <span class="type">Turn</span> mobile <span class="typedef"><span class="keyword">data</span> on or off.</span></span><br></pre></td></tr></table></figure>
<p><strong>svc data [enable|disable]</strong>:控制设备数据连接开与关</p>
<h3 id="svc-wifi-控制wifi管理"><a href="#svc-wifi-控制wifi管理" class="headerlink" title="svc wifi:控制wifi管理"></a>svc wifi:控制wifi管理</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell<span class="property">@mx2</span>:/ $ svc wifi -h</span><br><span class="line">Control the Wi-Fi manager</span><br><span class="line"></span><br><span class="line"><span class="attribute">usage</span>: svc wifi [enable|disable]</span><br><span class="line">         Turn Wi-Fi <span class="literal">on</span> <span class="keyword">or</span> <span class="literal">off</span>.</span><br></pre></td></tr></table></figure>
<p><strong>svc wifi [enable|disable]</strong>:控制wifi开与关</p>
<h3 id="svc-usb-控制usb状态"><a href="#svc-usb-控制usb状态" class="headerlink" title="svc usb:控制usb状态"></a>svc usb:控制usb状态</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">shell</span>@mx2:/ $ svc usb -h</span><br><span class="line">Control Usb state</span><br><span class="line"></span><br><span class="line">usage: svc usb setFunction [<span class="function"><span class="keyword">function</span>]</span></span><br><span class="line">         Set <span class="operator">the</span> current usb <span class="function"><span class="keyword">function</span>.</span></span><br><span class="line"></span><br><span class="line">       svc usb getFunction</span><br><span class="line">          Gets <span class="operator">the</span> list <span class="operator">of</span> currently enabled functions</span><br></pre></td></tr></table></figure>
<p><strong>svc usb setFunction [function]</strong>:设置当前USB功能<br>其中［function］包括：mtp,adb等  </p>
<p><strong>svc usb getFunction</strong>:获取当前可用功能列表</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android Debug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[monkey命令]]></title>
      <url>http://codingtrip.com/2016/05/24/0010-adb-shell-monkey/</url>
      <content type="html"><![CDATA[<h3 id="什么是Monkey"><a href="#什么是Monkey" class="headerlink" title="什么是Monkey?"></a>什么是Monkey?</h3><p>Monkey是我们在Android平台常用的一种压力测试方法，通过Monkey可模拟用户触摸，按键，滑动操作，常用于测试程序的稳定性。</p>
<p>monkey是一个shell脚本，存放于：/system/bin/monkey<br>使用如下命令: adb shell cat /system/bin/monkey 可以查看具体内容</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lcg@lcg-work-pc:~$ adb <span class="built_in">shell</span> cat /<span class="keyword">system</span>/bin/monkey</span><br><span class="line">* daemon <span class="operator">not</span> running. starting <span class="keyword">it</span> now <span class="command"><span class="keyword">on</span> <span class="title">port</span> <span class="title">5037</span> *</span></span><br><span class="line">* daemon started successfully *</span><br><span class="line"><span class="comment"># Script to start "monkey" on the device, which has a very rudimentary</span></span><br><span class="line"><span class="comment"># shell.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">base=/<span class="keyword">system</span></span><br><span class="line">export CLASSPATH=$base/framework/monkey.jar</span><br><span class="line">trap <span class="string">""</span> HUP</span><br><span class="line">exec app_process $base/bin com.android.commands.monkey.Monkey $*</span><br></pre></td></tr></table></figure>
<p>从上面内容可以看到，执行的时：/system/framework/monkey.jar　中内容．<br><a id="more"></a></p>
<h3 id="Monkey命令"><a href="#Monkey命令" class="headerlink" title="Monkey命令"></a>Monkey命令</h3><p>查看帮助：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb　<span class="keyword">shell</span> monkey　－<span class="keyword">help</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">lcg@lcg-work-pc:~$ adb shell monkey -help</span><br><span class="line">usage: monkey <span class="comment">[-p ALLOWED_PACKAGE <span class="comment">[-p ALLOWED_PACKAGE]</span> ...]</span></span><br><span class="line">              <span class="comment">[-c MAIN_CATEGORY <span class="comment">[-c MAIN_CATEGORY]</span> ...]</span></span><br><span class="line">              <span class="comment">[--ignore-crashes]</span> <span class="comment">[--ignore-timeouts]</span></span><br><span class="line">              <span class="comment">[--ignore-security-exceptions]</span></span><br><span class="line">              <span class="comment">[--monitor-native-crashes]</span> <span class="comment">[--ignore-native-crashes]</span></span><br><span class="line">              <span class="comment">[--kill-process-after-error]</span> <span class="comment">[--hprof]</span></span><br><span class="line">              <span class="comment">[--pct-touch PERCENT]</span> <span class="comment">[--pct-motion PERCENT]</span></span><br><span class="line">              <span class="comment">[--pct-trackball PERCENT]</span> <span class="comment">[--pct-syskeys PERCENT]</span></span><br><span class="line">              <span class="comment">[--pct-nav PERCENT]</span> <span class="comment">[--pct-majornav PERCENT]</span></span><br><span class="line">              <span class="comment">[--pct-appswitch PERCENT]</span> <span class="comment">[--pct-flip PERCENT]</span></span><br><span class="line">              <span class="comment">[--pct-anyevent PERCENT]</span> <span class="comment">[--pct-pinchzoom PERCENT]</span></span><br><span class="line">              <span class="comment">[--pct-permission PERCENT]</span></span><br><span class="line">              <span class="comment">[--pkg-blacklist-file PACKAGE_BLACKLIST_FILE]</span></span><br><span class="line">              <span class="comment">[--pkg-whitelist-file PACKAGE_WHITELIST_FILE]</span></span><br><span class="line">              <span class="comment">[--wait-dbg]</span> <span class="comment">[--dbg-no-events]</span></span><br><span class="line">              <span class="comment">[--setup scriptfile]</span> <span class="comment">[-f scriptfile <span class="comment">[-f scriptfile]</span> ...]</span></span><br><span class="line">              <span class="comment">[--port port]</span></span><br><span class="line">              <span class="comment">[-s SEED]</span> <span class="comment">[-v <span class="comment">[-v]</span> ...]</span></span><br><span class="line">              <span class="comment">[--throttle MILLISEC]</span> <span class="comment">[--randomize-throttle]</span></span><br><span class="line">              <span class="comment">[--profile-wait MILLISEC]</span></span><br><span class="line">              <span class="comment">[--device-sleep-time MILLISEC]</span></span><br><span class="line">              <span class="comment">[--randomize-script]</span></span><br><span class="line">              <span class="comment">[--script-log]</span></span><br><span class="line">              <span class="comment">[--bugreport]</span></span><br><span class="line">              <span class="comment">[--periodic-bugreport]</span></span><br><span class="line">              <span class="comment">[--permission-target-system]</span></span><br><span class="line">              COUNT</span><br></pre></td></tr></table></figure>
<p><strong>-p:</strong> 用于指定一个或者多个包，Monkey将只允许系统去访问这些包的activitys,如果应用需要访问其他包的activitys，连同这些包也一起指定在内．如果不指定任何包，Monkey默认可启动任何包的activitys．指定多个包，需要多次使用－p参数，一个－p参数对应一个包名,示例如下：</p>
<pre><code>adb shell monkey -p com.android.monkeytest1 -p com.android.monkeytest2
</code></pre><p><strong>-c:</strong> 用于指定一个或多个categories，Monkey将只能访问指定categories的activitys;如果未指定任何categories，将默认访问带有 Intent.CATEGORY_LAUNCHER 或　Intent.CATEGORY_MONKEY的activitys.指定多个categories的使用上与－p一致，一个参数对应一个categorie.<br><strong>［–ignore-crashes］:</strong> Monkey运行时忽略程序Crash或者异常信息未捕获，直到达到指定执行次数<br><strong>［–ignore-security-exceptions］:</strong> Monkey运行时忽略程序权限访问异常，直到达到指定执行次数<br><strong>［–monitor-native-crashes］:</strong>　观察并上报Android system native code异常<br><strong>［–kill-process-after-error］:</strong>  终止出现错误的进程<br><strong>［–pct-touch　PERCENT］:</strong>　调整touch事件（down-up event）比例<br><strong>［–pct-trackball　PERCENT］:</strong>　调整trackball事件（trackball事件：包含一个或多个随机动作，有时发生在点击事件之后）比例<br><strong>［–pct-nav　PERCENT］:</strong> 调整”basic” navigation事件比例. (Navigation事件即： 从可输入方向设备输入包含上／下／左／右方向事件.)<br><strong>［–pct-appswitch　PERCENT］:</strong> Monkey会在随机间隔时间，通过调用startActivity()来保证最大化覆盖包内所有activitys<br><strong>［–pct-anyevent　PERCENT］:</strong>　调整所有其他类型事件的比例，包括按键事件，其他在设备上很少使用的按钮等等<br><strong>［–pct-permission　PERCENT］:</strong>　<br><strong>［–pkg-blacklist-file　PACKAGE_BLACKLIST_FILE］:</strong>　执行黑名单以外的应用<br><strong>［–pkg-whitelist-file　PACKAGE_WHITELIST_FILE］:</strong>　执行白名单以外的应用<br><strong>［–wait-dbg］:</strong>　停止执行中的Monkey，直到有调试器和它相连接<br><strong>［–setup scriptfile］:</strong>　执行按照一定的语法规则编写有序的用户事件流并适用于monkey命令工具的脚本。<br><strong>［–port port］:</strong>　为monkey开启专用端口<br><strong>［-s SEED］:</strong>　随机数生成器的seed值。如果使用相同的seed值再次运行monkey，它将生成相同的事件序列<br><strong>［–throttle MILLISEC］:</strong>　设置每一次有效执行事件后休眠时间<br><strong>［–profile-wait MILLISEC］:</strong><br><strong>［–device-sleep-time MILLISEC］:</strong>　设备休眠时间<br><strong>［–randomize-script］:</strong>　monkey脚本内容随机执行<br><strong>［–script-log］:</strong>　输出monkey脚本log<br><strong>［–bugreport］:</strong> 设置Monkey运行时自动记录发生crash，anr，system not responding的错误信息。<br><strong>［–periodic-bugreport］:</strong><br><strong>［–permission-target-system］:</strong><br><strong>［COUNT］:</strong>　Monkey执行次数  </p>
<p>参考自：<a href="https://developer.android.com/studio/test/monkey.html" target="_blank" rel="external">https://developer.android.com/studio/test/monkey.html</a></p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android Debug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android性能优化]]></title>
      <url>http://codingtrip.com/2016/05/21/0009_Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
      <content type="html"><![CDATA[<h1 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h1><p>Java一个非常重要的优点就是垃圾回收机制，但如果使用不当的话，很容易引发<strong>内存泄漏</strong>问题。<br>Java内存回收机制：只有当某个对象不再引用时，它的内存才会被回收，如果某个本该被释放的<br>对象的引用仍然被持有时，此时内存泄漏就会发生。</p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>Java定义了四种类型的引用：  </p>
<p><strong>强引用（Strong）<br>弱引用（Weak）<br>软引用（Soft）<br>虚引用（Phantom）</strong></p>
<h3 id="强引用"><a href="#强引用" class="headerlink" title="强引用"></a>强引用</h3><p>最常见的一种，我们所写的代码中大部分都是强引用，如果一个对象具有强引用，那垃圾回收器绝不会回收它。如：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br></pre></td></tr></table></figure></p>
<p>如果该对象不再使用，需要显式将其置为null<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="软引用"><a href="#软引用" class="headerlink" title="软引用"></a>软引用</h3><p>当存在足够的内存保存对象时，垃圾收集器不会回收，只有当内存不足时才会被GC回收，适合用于设计Cache。</p>
<h3 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h3><p>一旦GC的时候发现了某个对象是弱引用，就会被回收，不管现在内存是否足够;适合应用于映射，这种映射可以自动删除不再被引用的键（如WeakHashMap）<br>通常用于在某处保存对象引用，而又不干扰该对象被GC回收，通常用于Debug、内存监视工具等程序中。因为这类程序一般要求即要观察到对象，又不能影响该对象正常的GC过程。</p>
<h3 id="虚引用"><a href="#虚引用" class="headerlink" title="虚引用"></a>虚引用</h3><p>虚引用并不会决定对象的生命周期。如果一个对象仅持有虚引用，那么它就和没有任何引用一样，在任何时候都可能被垃圾回收器回收。<br><a id="more"></a></p>
<h2 id="常见情形"><a href="#常见情形" class="headerlink" title="常见情形"></a>常见情形</h2><h3 id="屏幕旋转"><a href="#屏幕旋转" class="headerlink" title="屏幕旋转"></a>屏幕旋转</h3><h2 id="常用方法或工具"><a href="#常用方法或工具" class="headerlink" title="常用方法或工具"></a>常用方法或工具</h2><h3 id="StrictMode类"><a href="#StrictMode类" class="headerlink" title="StrictMode类"></a>StrictMode类</h3><p>Android3.0以上：<br>1、Activity泄漏<br>2、其他对象泄漏<br>3、对象未关闭造成的泄漏（如游标，输入输出流等所有实现Closeable接口的类）<br>以下是示例代码实现（记得只在开发和调试中使用）：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Application</span> &#123;</span></span><br><span class="line">  public static <span class="keyword">final</span> boolean <span class="type">DEBUG_MODLE</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  public void onCreate() &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    <span class="keyword">if</span>(<span class="type">DEBUG_MODLE</span>)&#123;</span><br><span class="line">      <span class="type">StrictMode</span>.<span class="type">VmPolicy</span>.<span class="type">Builder</span> builder = <span class="keyword">new</span> <span class="type">StrictMode</span>.<span class="type">VmPolicy</span>.<span class="type">Builder</span>();</span><br><span class="line">      builder.detectAll();</span><br><span class="line">      builder.penaltyLog();</span><br><span class="line">      <span class="comment">// builder.penaltyDeath();</span></span><br><span class="line">      <span class="type">StrictMode</span>.<span class="type">VmPolicy</span> vmp = builder.build();</span><br><span class="line">      <span class="type">StrictMode</span>.setVmPolicy(vmp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="OnLowMemory-amp-OnTrimMemory"><a href="#OnLowMemory-amp-OnTrimMemory" class="headerlink" title="OnLowMemory&amp;OnTrimMemory"></a>OnLowMemory&amp;OnTrimMemory</h3><p>OnLowMemory是Android提供的API，所有后台程序（优先级为background的进程，不是指后台运行的进程）都被杀死时，在系统内存还不足时，系统会调用OnLowMemory。<br>OnTrimMemory是Android 4.0之后提供的API，系统会根据不同的内存状态来回调。根据不同的内存状态，来响应不同的内存释放策略。<br>以下几点是我们常常要考虑释放的资源：<br><strong>缓存或缓存条目（如使用强引用的LruCache）<br>可以再次按需生成的位图对象<br>不可见的布局对象<br>数据库对象</strong>  </p>
<h3 id="TraceView"><a href="#TraceView" class="headerlink" title="TraceView"></a>TraceView</h3><p>先找瓶颈，再优化代码，物尽其用</p>
<h1 id="电量篇"><a href="#电量篇" class="headerlink" title="电量篇"></a>电量篇</h1><h2 id="禁用和启用广播接收器"><a href="#禁用和启用广播接收器" class="headerlink" title="禁用和启用广播接收器"></a>禁用和启用广播接收器</h2><h2 id="数据传输"><a href="#数据传输" class="headerlink" title="数据传输"></a>数据传输</h2><p>1、检查是否允许后台传输数据<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h3 id="ViewStub"><a href="#ViewStub" class="headerlink" title="ViewStub"></a>ViewStub</h3><p>复杂布局在代码中展开</p>
<h3 id="Hierarchy-‘haɪərɑrki-Viewer（）"><a href="#Hierarchy-‘haɪərɑrki-Viewer（）" class="headerlink" title="Hierarchy[‘haɪərɑrki] Viewer（）"></a>Hierarchy[‘haɪərɑrki] Viewer（）</h3><h3 id="layoutopt"><a href="#layoutopt" class="headerlink" title="layoutopt"></a>layoutopt</h3>]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android进阶 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[单元测试实践-android]]></title>
      <url>http://codingtrip.com/2016/05/19/0008_%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5%EF%BC%88android%EF%BC%89/</url>
      <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>单元测试是最基础的测试，有效的单元测试将直接提升产品质量。软件开发工程师应当将编写和运行测试作为开发过程的一部分，<br>良好的单元测试能够在开发早期发现软件缺陷，让工程师对自己写的代码感到自信。<br>本文将描述如何使用JUnit4框架在Android工程中进行单元测试，开发环境为Android Studio，Android中有两种单元测试：<br>Local Unit Tests和Instrumented Tests，Instrumented Tests依赖于设备，可进行单元、组件、界面测试，<br>本文重点描述如何进行本地单元测试（Local Unit Tests）。<br>注：文中提到的例子在Google Samples的BasicSample基础上进行了部分修改。<br><a id="more"></a></p>
<h2 id="单元测试组成"><a href="#单元测试组成" class="headerlink" title="单元测试组成"></a>单元测试组成</h2><h3 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h3><p>使用版本管理控制软件，推荐使用git，目前最好的版本控制软件，没有之一。<br><a href="https://git-scm.com/downloads" target="_blank" rel="external">https://git-scm.com/downloads</a></p>
<h3 id="构建管理工具"><a href="#构建管理工具" class="headerlink" title="构建管理工具"></a>构建管理工具</h3><p>Android Studio默认集成工具为gradle。<br><a href="https://docs.gradle.org/current/userguide/userguide.html" target="_blank" rel="external">https://docs.gradle.org/current/userguide/userguide.html</a></p>
<h3 id="测试框架"><a href="#测试框架" class="headerlink" title="测试框架"></a>测试框架</h3><p>单元测试框架junit4<br><a href="http://junit.org/junit4/" target="_blank" rel="external">http://junit.org/junit4/</a></p>
<p>模拟对象框架mockito<br><a href="http://mockito.org/" target="_blank" rel="external">http://mockito.org/</a></p>
<p>模拟真机功能Robolectric。<br><a href="http://robolectric.org/" target="_blank" rel="external">http://robolectric.org/</a></p>
<h3 id="持续集成平台"><a href="#持续集成平台" class="headerlink" title="持续集成平台"></a>持续集成平台</h3><p>自动化构建工具，推荐使用jenkins。<br><a href="https://jenkins.io/index.html" target="_blank" rel="external">https://jenkins.io/index.html</a></p>
<h2 id="Android单元测试介绍"><a href="#Android单元测试介绍" class="headerlink" title="Android单元测试介绍"></a>Android单元测试介绍</h2><h3 id="单元测试目录"><a href="#单元测试目录" class="headerlink" title="单元测试目录"></a>单元测试目录</h3><p>工程目录app-&gt;src-&gt;test目录</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%871.png" alt="UnitTest"><br></div>

<h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><p>在工程app/build.gralde文件中增加如下依赖<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    // Unit testing dependencies.</span><br><span class="line">    <span class="built_in">test</span>Compile <span class="string">'junit:junit:4.12'</span></span><br><span class="line">    <span class="built_in">test</span>Compile <span class="string">'org.mockito:mockito-core:1.10.19'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="添加代码覆盖率支持"><a href="#添加代码覆盖率支持" class="headerlink" title="添加代码覆盖率支持"></a>添加代码覆盖率支持</h3><p>增加jacoco支持<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'jacoco'</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ependencies &#123;</span><br><span class="line">    // Unit testing dependencies.</span><br><span class="line">    <span class="built_in">test</span>Compile <span class="string">'junit:junit:4.12'</span></span><br><span class="line">    <span class="built_in">test</span>Compile <span class="string">'org.mockito:mockito-core:1.10.19'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>// 增加jacoco，工具版本可以根据最新版本进行修改<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">jacoco</span> &#123;</span><br><span class="line">    <span class="title">toolVersion</span> = <span class="string">"0.7.6.201602180812"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="增加覆盖率统计和Lint选项"><a href="#增加覆盖率统计和Lint选项" class="headerlink" title="增加覆盖率统计和Lint选项"></a>增加覆盖率统计和Lint选项</h3><p>Android节点buildTypes增加testCoverageEnabled = true<br>Lint选项设置为遇到错误不终止。<br><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="name">android</span> &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">'23.0.2'</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"com.example.android.testing.unittesting.BasicSample"</span></span><br><span class="line">        minSdkVersion <span class="number">8</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line">        targetSdkVersion <span class="number">23</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="name">buildTypes</span> &#123;</span><br><span class="line">        debug &#123;</span><br><span class="line">            testCoverageEnabled = <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="name">productFlavors</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="name">lintOptions</span> &#123;</span><br><span class="line">        // I prefer avoiding a build fail <span class="keyword">if</span> there is any warning, for they are only warnings</span><br><span class="line">        abortOnError <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="图形化运行单元测试工具"><a href="#图形化运行单元测试工具" class="headerlink" title="图形化运行单元测试工具"></a>图形化运行单元测试工具</h3><p>android studio自动集成了单元测试覆盖率统计工具，选中编写好的测试类，右键点击Run ‘XXXXXX’ with Coverage。</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%872.png" alt="UnitTest"><br></div>

<h3 id="查看覆盖率"><a href="#查看覆盖率" class="headerlink" title="查看覆盖率"></a>查看覆盖率</h3><p>出现覆盖率面板，按F4或双击相关行，可以打开源代码查看具体哪些行没有覆盖到。</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%873.png" alt="UnitTest"><br></div>

<h3 id="查看代码覆盖情况"><a href="#查看代码覆盖情况" class="headerlink" title="查看代码覆盖情况"></a>查看代码覆盖情况</h3><p>两种颜色表明覆盖和未覆盖两种状态，此时开发工程师应当分析是否需要增加新的测试代码对未进行测试的语句行覆盖。</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%874.png" alt="UnitTest"><br></div>

<h2 id="Jenkins配置说明"><a href="#Jenkins配置说明" class="headerlink" title="Jenkins配置说明"></a>Jenkins配置说明</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%875.png" alt="UnitTest"><br></div>

<h3 id="配置仓库"><a href="#配置仓库" class="headerlink" title="配置仓库"></a>配置仓库</h3><p>推荐使用git，目前最好的版本控制软件，没有之一。</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%876.png" alt="UnitTest"><br></div>

<h3 id="构建触发器"><a href="#构建触发器" class="headerlink" title="构建触发器"></a>构建触发器</h3><p>一般选择定时检测版本库，有提交就自动构建。</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%877.png" alt="UnitTest"><br></div>

<h3 id="增加构建Gradle命令"><a href="#增加构建Gradle命令" class="headerlink" title="增加构建Gradle命令"></a>增加构建Gradle命令</h3><div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%878.png" alt="UnitTest"><br></div>

<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%879.png" alt="UnitTest"><br></div>

<h3 id="构建后操作-增加Lint结果"><a href="#构建后操作-增加Lint结果" class="headerlink" title="构建后操作-增加Lint结果"></a>构建后操作-增加Lint结果</h3><div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8710.png" alt="UnitTest"><br></div>

<p>在Lint files项填入**/app/build/outputs/lint-results-debug.xml</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8711.png" alt="UnitTest"><br></div>

<h3 id="构建后操作-增加JUnit测试报告"><a href="#构建后操作-增加JUnit测试报告" class="headerlink" title="构建后操作-增加JUnit测试报告"></a>构建后操作-增加JUnit测试报告</h3><p>在测试报告项填入<strong>/build/test-results/</strong>/*.xml</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8712.png" alt="UnitTest"><br></div>

<h3 id="构建后操作-增加覆盖率报告"><a href="#构建后操作-增加覆盖率报告" class="headerlink" title="构建后操作-增加覆盖率报告"></a>构建后操作-增加覆盖率报告</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Path to exec files项增加<span class="keyword">*</span><span class="keyword">*</span>/build/jacoco/<span class="keyword">*</span>.exec</span><br><span class="line">Path to class directories项增加<span class="keyword">*</span><span class="keyword">*</span>/build/intermediates/classes</span><br><span class="line">Path to source directories增加<span class="keyword">*</span><span class="keyword">*</span>/src/main/java</span><br><span class="line">Exclusions项增加：</span><br><span class="line"><span class="keyword">*</span><span class="keyword">*</span>/R.class, <span class="keyword">*</span><span class="keyword">*</span>/R$<span class="keyword">*</span>.class, <span class="keyword">*</span><span class="keyword">*</span>/<span class="keyword">*</span>$ViewInjector<span class="keyword">*</span>.<span class="keyword">*</span>,<span class="keyword">*</span><span class="keyword">*</span>/BuildConfig.<span class="keyword">*</span>,<span class="keyword">*</span><span class="keyword">*</span>/Manifest<span class="keyword">*</span>.<span class="keyword">*</span></span><br></pre></td></tr></table></figure>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8713.png" alt="UnitTest"><br></div>

<h3 id="邮件通知"><a href="#邮件通知" class="headerlink" title="邮件通知"></a>邮件通知</h3><p>填写接收构建失败邮件的邮箱地址，需要确认在Jenkins的系统管理中增加了邮件服务器和管理员的配置。</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8714.png" alt="UnitTest"><br></div>

<h3 id="自动集成效果"><a href="#自动集成效果" class="headerlink" title="自动集成效果"></a>自动集成效果</h3><div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8715.png" alt="UnitTest"><br></div>

<p>点击各目录可查看详细的问题信息</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8716.png" alt="UnitTest"><br></div>

<p>点击文件名可查看具体的代码行覆盖情况</p>
<div align="left"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/unit_test/%E5%9B%BE%E7%89%8717.png" alt="UnitTest"><br></div>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android基础 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android onMeasure & onLayout]]></title>
      <url>http://codingtrip.com/2016/04/05/0006_android%E8%87%AA%E5%AE%9A%E4%B9%89View%E4%B8%8EViewGroup/</url>
      <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>在android的自定义view中,onMeasure与onLayout这两个方法无疑是最重要的,只有深刻理解了这两个方法,才能写出我们自己想要的view/viewgroup</p>
<p>我们先看源码注释中对这两个方法的解释:<br>注：本文源码基于android-17</p>
<h3 id="onMeasure"><a href="#onMeasure" class="headerlink" title="onMeasure"></a>onMeasure</h3><pre><code>* &lt;p&gt;
* Measure the view and its content to determine the measured width and the
* measured height. This method is invoked by {@link #measure(int, int)} and
* should be overriden by subclasses to provide accurate and efficient
* measurement of their contents.
* &lt;/p&gt;
</code></pre><a id="more"></a>
<p>如注释中所述: 通过测量当前view和它的contents,来决定当前所测量出的宽度和高度.这个方法被measure(int, int)调用,并且子类应当重写该方法,<br>用以提供精确高效的测量方法来测量它的contents.<br>上文提到onMeasure是在measure(int, int)中被调用的,下面就来看一下measure(int, int)方法的源码：<br>     /**</p>
<pre><code> * &lt;p&gt;
 * This is called to find out how big a view should be. The parent
 * supplies constraint information in the width and height parameters.
 * &lt;/p&gt;
 * &lt;br&gt;该方法被用于测量某个view所需大小，父视图提供宽度和高度的约束信息
 *
 * &lt;p&gt;
 * The actual measurement work of a view is performed in
 * {@link #onMeasure(int, int)}, called by this method. Therefore, only
 * {@link #onMeasure(int, int)} can and must be overridden by subclasses.
 * &lt;/p&gt;
 *
 *
 * @param widthMeasureSpec Horizontal space requirements as imposed by the
 *        parent
 * @param heightMeasureSpec Vertical space requirements as imposed by the
 *        parent
 *
 * @see #onMeasure(int, int)
 */
public final void measure(int widthMeasureSpec, int heightMeasureSpec) {
    if ((mPrivateFlags &amp; PFLAG_FORCE_LAYOUT) == PFLAG_FORCE_LAYOUT || //mPrivateFlags是否为FORCE LAYOUT
            widthMeasureSpec != mOldWidthMeasureSpec ||
            heightMeasureSpec != mOldHeightMeasureSpec) {

        // first clears the measured dimension flag
        //清除MEASURED_DIMENSION_SET标记
        mPrivateFlags &amp;= ~PFLAG_MEASURED_DIMENSION_SET;

        //Resolve all RTL related properties.
        resolveRtlPropertiesIfNeeded();

        // measure ourselves, this should set the measured dimension flag back
        //测量view自身，并且重新设置PFLAG_MEASURED_DIMENSION_SET标记
        onMeasure(widthMeasureSpec, heightMeasureSpec);

        //如果未重新设置PFLAG_MEASURED_DIMENSION_SET标记将会抛出异常
        // flag not set, setMeasuredDimension() was not invoked, we raise
        // an exception to warn the developer
        if ((mPrivateFlags &amp; PFLAG_MEASURED_DIMENSION_SET) != PFLAG_MEASURED_DIMENSION_SET) {
            throw new IllegalStateException(&quot;onMeasure() did not set the&quot;
                    + &quot; measured dimension by calling&quot;
                    + &quot; setMeasuredDimension()&quot;);
        }
        //设置标志，请求layout
        mPrivateFlags |= PFLAG_LAYOUT_REQUIRED;
    }

    mOldWidthMeasureSpec = widthMeasureSpec;
    mOldHeightMeasureSpec = heightMeasureSpec;
}
</code></pre><p>下面我们看下onMeasure方法源码，及该方法中调用的相关源码</p>
<pre><code>protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
    setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),
            getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));
}


/**
 * &lt;p&gt;This mehod must be called by {@link #onMeasure(int, int)} to store the
 * measured width and measured height. Failing to do so will trigger an
 * exception at measurement time.&lt;/p&gt;&lt;br&gt;设置当前视图的mMeasuredWidth与mMeasuredHeight
 *
 * @param measuredWidth The measured width of this view.  May be a complex
 * bit mask as defined by {@link #MEASURED_SIZE_MASK} and
 * {@link #MEASURED_STATE_TOO_SMALL}.
 * @param measuredHeight The measured height of this view.  May be a complex
 * bit mask as defined by {@link #MEASURED_SIZE_MASK} and
 * {@link #MEASURED_STATE_TOO_SMALL}.
 */
protected final void setMeasuredDimension(int measuredWidth, int measuredHeight) {
    mMeasuredWidth = measuredWidth;
    mMeasuredHeight = measuredHeight;

    mPrivateFlags |= PFLAG_MEASURED_DIMENSION_SET;
}

/**
 * Utility to return a default size. Uses the supplied size if the
 * MeasureSpec imposed no constraints. Will get larger if allowed
 * by the MeasureSpec.&lt;br&gt;返回一个默认大小。如果MeasureSpec中不包含限制，将返回参数size的大小；
 *
 * @param size Default size for this view
 * @param measureSpec Constraints imposed by the parent
 * @return The size this view should be.
 */
public static int getDefaultSize(int size, int measureSpec) {
    int result = size;
    int specMode = MeasureSpec.getMode(measureSpec);
    int specSize = MeasureSpec.getSize(measureSpec);

    switch (specMode) {
    case MeasureSpec.UNSPECIFIED:
        result = size;
        break;
    case MeasureSpec.AT_MOST:
    case MeasureSpec.EXACTLY:
        result = specSize;
        break;
    }
    return result;
}

/**
 * Returns the suggested minimum width that the view should use. This
 * returns the maximum of the view&apos;s minimum width)
 * and the background&apos;s minimum width&lt;br&gt;
 * 返回视图建议使用的最小宽度（该视图最小宽度与背景图最小宽度中的最大值）
 *  ({@link android.graphics.drawable.Drawable#getMinimumWidth()}).
 * &lt;p&gt;
 * When being used in {@link #onMeasure(int, int)}, the caller should still
 * ensure the returned width is within the requirements of the parent.
 *
 * @return The suggested minimum width of the view.
 */
protected int getSuggestedMinimumWidth() {
    return (mBackground == null) ? mMinWidth : max(mMinWidth, mBackground.getMinimumWidth());
}

protected int getSuggestedMinimumHeight() {
    return (mBackground == null) ? mMinHeight : max(mMinHeight, mBackground.getMinimumHeight());

}
</code></pre>]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android进阶 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Androi屏幕分辨率（mdpi、hdpi、xdpi、xxdpi、xxxdpi）]]></title>
      <url>http://codingtrip.com/2016/03/17/0005_Android%E5%B1%8F%E5%B9%95%E5%88%86%E8%BE%A8%E7%8E%87/</url>
      <content type="html"><![CDATA[<h1 id="（一）基础名词"><a href="#（一）基础名词" class="headerlink" title="（一）基础名词"></a>（一）基础名词</h1><h2 id="1、屏幕尺寸，屏幕分辨率与屏幕像素密度"><a href="#1、屏幕尺寸，屏幕分辨率与屏幕像素密度" class="headerlink" title="1、屏幕尺寸，屏幕分辨率与屏幕像素密度"></a>1、屏幕尺寸，屏幕分辨率与屏幕像素密度</h2><p><strong>屏幕尺寸：</strong> 就是我们通常所说的手机大小，比如iPhone6s大小为4.7寸，确切的来说这里指的是英寸（1 in ≈ 2.54 cm)<br>这个大小又屏幕对角线的长度确定<br><strong>屏幕分辨率:</strong> 指的是屏幕纵向与横向上像素点的数量，比如1920×1080,代表的是在屏幕纵向有1920个像素点，横向有1080个像素点<br><strong>屏幕像素密度：</strong> 每英寸屏幕所拥有的像素数（单位dpi）像素密度越大，显示画面细节就越丰富，也就是我们通常所说的屏幕越清晰<br>计算公式： dpi =√(widthPx^2 + heightPx^2) / 屏幕尺寸</p>
<div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/screen_resolution/calculation_formula.png" alt="计算公式"><br></div><br><a id="more"></a><br>## 2、px、dp、dpi、sp、dpi、density<br><strong>px:</strong> 我们日常所称的像素（pixel），图像显示的基本单位<br><strong>dip/dp:</strong> 密度无关像素(Density Independent Pixels)<br><strong>sp:</strong> scaled pixels，主要处理字体的大小。与dp类似，但是可以根据用户的字体大小首选项进行缩放。<br><strong>dpi:</strong> 每英寸点数,这里的点指的是像素点<br><br>以160dpi为基准，1dp=1px<br><br>## 3、mdpi、hdpi、xdpi、xxdpi、xxxdpi<br>用于区分不同的像素密度，关系如下：<br><div align="center"><br><img src="http://o7ig1vigz.bkt.clouddn.com/android/screen_resolution/dpi.png" alt="dpi"><br></div>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android基础 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Tips(二)]]></title>
      <url>http://codingtrip.com/2015/09/20/0004_Android_Tips_002/</url>
      <content type="html"><![CDATA[<h3 id="判断应用是否联网"><a href="#判断应用是否联网" class="headerlink" title="判断应用是否联网"></a>判断应用是否联网</h3><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 判断是否联网</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@param</span> context</span><br><span class="line"> * <span class="doctag">@return</span> boolean true,已联网;false,断网状态</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> isNetwork(Context context) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ConnectivityManager manger = (ConnectivityManager) context</span><br><span class="line">                .getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line">        NetworkInfo info = manger.getActiveNetworkInfo();</span><br><span class="line">        <span class="keyword">return</span> (info != <span class="keyword">null</span> &amp;&amp; info.isConnected());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"判断是否有网络出错"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="判断字符是否中文"><a href="#判断字符是否中文" class="headerlink" title="判断字符是否中文"></a>判断字符是否中文</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@Description: 判断字符是否中文</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param c</span></span><br><span class="line"> <span class="keyword">*</span>            字符</span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@return boolean</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@author</span></span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@data</span></span><br><span class="line"> <span class="keyword">*</span>/</span><br><span class="line">public boolean isChinese(char c) &#123;</span><br><span class="line">	Character.UnicodeBlock ub = Character.UnicodeBlock.of(c);</span><br><span class="line">	if (ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS</span><br><span class="line">			||<span class="string"> ub == Character.UnicodeBlock.CJK_COMPATIBILITY_IDEOGRAPHS</span><br><span class="line">			</span>||<span class="string"> ub == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A</span><br><span class="line">			</span>||<span class="string"> ub == Character.UnicodeBlock.GENERAL_PUNCTUATION</span><br><span class="line">			</span>||<span class="string"> ub == Character.UnicodeBlock.CJK_SYMBOLS_AND_PUNCTUATION</span><br><span class="line">			</span>||<span class="string"> ub == Character.UnicodeBlock.HALFWIDTH_AND_FULLWIDTH_FORMS) &#123;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line">	return false;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="显示-隐藏软键盘"><a href="#显示-隐藏软键盘" class="headerlink" title="显示/隐藏软键盘"></a>显示/隐藏软键盘</h3><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 显示软键盘 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">ShowSoftKeyborad</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">	InputMethodManager inputMethodManager = (InputMethodManager) context</span><br><span class="line">			.getSystemService(Context.INPUT_METHOD_SERVICE);</span><br><span class="line">	inputMethodManager.showSoftInput(<span class="keyword">this</span>,</span><br><span class="line">			InputMethodManager.RESULT_UNCHANGED_SHOWN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 隐藏软键盘 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">hideSoftKeyborad</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">	InputMethodManager inputMethodManager = (InputMethodManager) context</span><br><span class="line">			.getSystemService(Context.INPUT_METHOD_SERVICE);</span><br><span class="line">	inputMethodManager.hideSoftInputFromWindow(getWindowToken(),</span><br><span class="line">			InputMethodManager.RESULT_UNCHANGED_HIDDEN);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="判断是否是输入法应用"><a href="#判断是否是输入法应用" class="headerlink" title="判断是否是输入法应用"></a>判断是否是输入法应用</h3><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">boolean</span> <span class="title">isInputMethodApp</span><span class="params">(Context context, String packageName)</span> </span>&#123;</span><br><span class="line">	PackageManager pm = context.getPackageManager();</span><br><span class="line">	<span class="keyword">boolean</span> isInputMethodApp = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		PackageInfo pkgInfo = pm.getPackageInfo(packageName, PackageManager.GET_SERVICES);</span><br><span class="line">		ServiceInfo[] sInfo = pkgInfo.services;</span><br><span class="line">		<span class="keyword">if</span> (sInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sInfo.length; i++) &#123;</span><br><span class="line">				ServiceInfo serviceInfo = sInfo[i];</span><br><span class="line">				<span class="keyword">if</span> (serviceInfo.permission != <span class="keyword">null</span></span><br><span class="line">						&amp;&amp; serviceInfo.permission.equals(<span class="string">"android.permission.BIND_INPUT_METHOD"</span>)) &#123;</span><br><span class="line">					isInputMethodApp = <span class="keyword">true</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> isInputMethodApp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android基础 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Tips(一)]]></title>
      <url>http://codingtrip.com/2015/09/15/0003_Android_Tips_001/</url>
      <content type="html"><![CDATA[<h3 id="判断设备是否是大屏设备"><a href="#判断设备是否是大屏设备" class="headerlink" title="判断设备是否是大屏设备"></a>判断设备是否是大屏设备</h3><p>只需在相应分辨率的value配置文件下写入不同的值，如：<br>在/values/cofig.xml 文件中写入：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"is_large_tablet"</span>&gt;<span class="keyword">false</span>&lt;/<span class="keyword">bool</span>&gt;</span><br></pre></td></tr></table></figure>
<p>在/values-sw720p/cofig.xml 文件中写入：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"is_large_tablet"</span>&gt;<span class="keyword">true</span>&lt;/<span class="keyword">bool</span>&gt;</span><br></pre></td></tr></table></figure>
<p>然后在方法中调用：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">boolean</span> <span class="title">isScreenLarge</span><span class="params">(Resources res)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">return</span> res.<span class="title">getBoolean</span><span class="params">(R.bool.is_large_tablet)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="判断是否横屏"><a href="#判断是否横屏" class="headerlink" title="判断是否横屏"></a>判断是否横屏</h3><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">boolean</span> <span class="title">isScreenLandscape</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> context.getResources().getConfiguration().orientation ==</span><br><span class="line">        Configuration.ORIENTATION_LANDSCAPE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="判断某个包名的应用是否已安装"><a href="#判断某个包名的应用是否已安装" class="headerlink" title="判断某个包名的应用是否已安装"></a>判断某个包名的应用是否已安装</h3><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">boolean</span> haveInstallApp(Context context,<span class="keyword">String</span> packageName) &#123;</span><br><span class="line">    <span class="keyword">if</span>(TextUtils.isEmpty(packageName)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// get packagemanager</span></span><br><span class="line">    PackageManager packageManager =context.getPackageManager();</span><br><span class="line">    <span class="comment">// 获取所有已安装程序的包信息</span></span><br><span class="line">    List&lt;PackageInfo&gt; info = packageManager.getInstalledPackages(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; info.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">String</span> installPackageName = info.<span class="built_in">get</span>(i).packageName;</span><br><span class="line">            <span class="keyword">if</span>(packageName.equals(installPackageName)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取当前程序可用内存"><a href="#获取当前程序可用内存" class="headerlink" title="获取当前程序可用内存"></a>获取当前程序可用内存</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> 获取当前可用内存，返回数据以字节为单位。</span><br><span class="line"> <span class="keyword">*</span>  </span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@param context</span></span><br><span class="line"> <span class="keyword">*</span>            可传入应用程序上下文。</span><br><span class="line"> <span class="keyword">*</span> <span class="comment">@return 当前可用内存。</span></span><br><span class="line"> <span class="keyword">*</span>/  </span><br><span class="line">private static long getAvailableMemory(Context context) &#123;  </span><br><span class="line">    ActivityManager.MemoryInfo mi = new ActivityManager.MemoryInfo();  </span><br><span class="line">    getActivityManager(context).getMemoryInfo(mi);  </span><br><span class="line">    return mi.availMem;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取状态栏的高度"><a href="#获取状态栏的高度" class="headerlink" title="获取状态栏的高度"></a>获取状态栏的高度</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 用于获取状态栏的高度。</span><br><span class="line"> *  </span><br><span class="line"> * @return 返回状态栏高度的像素值。</span><br><span class="line"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getStatusBarHeight</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (statusBarHeight == <span class="number">0</span>) &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            Class&lt;?&gt; c = Class.forName(<span class="string">"com.android.internal.R$dimen"</span>);  </span><br><span class="line">            Object o = c.newInstance();  </span><br><span class="line">            Field field = c.getField(<span class="string">"status_bar_height"</span>);  </span><br><span class="line">            <span class="keyword">int</span> x = (Integer) field.get(o);  </span><br><span class="line">            statusBarHeight = getResources().getDimensionPixelSize(x);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> statusBarHeight;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取所有桌面应用程序包名"><a href="#获取所有桌面应用程序包名" class="headerlink" title="获取所有桌面应用程序包名"></a>获取所有桌面应用程序包名</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/**</span><br><span class="line"> * 获得属于桌面的应用的应用包名称</span><br><span class="line"> *  </span><br><span class="line"> * @return 返回包含所有包名的字符串列表</span><br><span class="line"> */</span></span>  </span><br><span class="line">private <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; getHomes() &#123;  </span><br><span class="line">    <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; names = <span class="keyword">new</span> ArrayList&lt;<span class="built_in">String</span>&gt;();  </span><br><span class="line">    PackageManager packageManager = <span class="keyword">this</span>.getPackageManager();  </span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_MAIN);  </span><br><span class="line">    intent.addCategory(Intent.CATEGORY_HOME);  </span><br><span class="line">    <span class="built_in">List</span>&lt;ResolveInfo&gt; resolveInfo = packageManager.queryIntentActivities(intent,  </span><br><span class="line">            PackageManager.MATCH_DEFAULT_ONLY);  </span><br><span class="line">    <span class="keyword">for</span> (ResolveInfo ri : resolveInfo) &#123;  </span><br><span class="line">        names.add(ri.activityInfo.packageName);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> names;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取软键盘按键（Enter-go等），并实现自定义功能"><a href="#获取软键盘按键（Enter-go等），并实现自定义功能" class="headerlink" title="获取软键盘按键（Enter go等），并实现自定义功能"></a>获取软键盘按键（Enter go等），并实现自定义功能</h3><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">    edittext.setOnEditorActionListener(<span class="keyword">new</span> TextView.OnEditorActionListener() &#123;  </span><br><span class="line"></span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onEditorAction</span><span class="params">(TextView v, <span class="keyword">int</span> actionId, KeyEvent event)</span> </span>&#123;  </span><br><span class="line">                <span class="comment">/*判断是否是“GO”键*/</span>  </span><br><span class="line">                <span class="keyword">if</span>(actionId == EditorInfo.IME_ACTION_GO)&#123;  </span><br><span class="line">                    <span class="comment">/*隐藏软键盘*/</span>  </span><br><span class="line">                    InputMethodManager imm = (InputMethodManager) v  </span><br><span class="line">                            .getContext().getSystemService(  </span><br><span class="line">                                    Context.INPUT_METHOD_SERVICE);  </span><br><span class="line">                    <span class="keyword">if</span> (imm.isActive()) &#123;  </span><br><span class="line">                        imm.hideSoftInputFromWindow(  </span><br><span class="line">                                v.getApplicationWindowToken(), <span class="number">0</span>);  </span><br><span class="line">                    &#125;  </span><br><span class="line"></span><br><span class="line">                    edittext.setText(<span class="string">"success"</span>);  </span><br><span class="line">                    webview.loadUrl(URL);  </span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">    &lt;EditText  </span><br><span class="line">        android:id=<span class="string">"@+id/edittext"</span>  </span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span>  </span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span>  </span><br><span class="line">        android:singleLine=<span class="string">"true"</span>  </span><br><span class="line">        android:imeOptions=<span class="string">"actionSearch"</span>/&gt;  </span><br><span class="line">    actionNone : 回车键，按下后光标到下一行</span><br><span class="line">    actionGo ： Go，</span><br><span class="line">    actionSearch ： 放大镜</span><br><span class="line">    actionSend ： Send</span><br><span class="line">    actionNext ： Next</span><br><span class="line">    actionDone ： Done，确定/完成，隐藏软键盘，即使不是最后一个文本输入框</span><br></pre></td></tr></table></figure>
<h3 id="获取栈顶Activity"><a href="#获取栈顶Activity" class="headerlink" title="获取栈顶Activity"></a>获取栈顶Activity</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getClassNameOnStackTop</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">	ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);</span><br><span class="line">	ComponentName cn = am.getRunningTasks(<span class="number">1</span>).get(<span class="number">0</span>).topActivity;</span><br><span class="line">	String className = cn.getClassName();</span><br><span class="line">	LogUtil.d(<span class="string">"top activity="</span> + className);</span><br><span class="line">	<span class="keyword">return</span> className;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取屏幕方向"><a href="#获取屏幕方向" class="headerlink" title="获取屏幕方向"></a>获取屏幕方向</h3><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">private int getDeviceOrientation(Context context) &#123;</span><br><span class="line">    WindowManager windowManager =  (WindowManager)</span><br><span class="line">            context<span class="string">.getSystemService(Context.WINDOW_SERVICE)</span>;</span><br><span class="line">    Resources resources = context<span class="string">.getResources()</span>;</span><br><span class="line">    DisplayMetrics dm = resources<span class="string">.getDisplayMetrics()</span>;</span><br><span class="line">    Configuration config = resources<span class="string">.getConfiguration()</span>;</span><br><span class="line">    int rotation = windowManager<span class="string">.getDefaultDisplay().getRotation()</span>;</span><br><span class="line">    boolean isLandscape = (config<span class="string">.orientation</span> == Configuration<span class="string">.ORIENTATION_LANDSCAPE)</span> &amp;&amp;</span><br><span class="line">            (rotation == Surface<span class="string">.ROTATION_0</span> || rotation == Surface<span class="string">.ROTATION_180)</span>;</span><br><span class="line">    boolean isRotatedPortrait = (config<span class="string">.orientation</span> == Configuration<span class="string">.ORIENTATION_PORTRAIT)</span> &amp;&amp;</span><br><span class="line">            (rotation == Surface<span class="string">.ROTATION_90</span> || rotation == Surface<span class="string">.ROTATION_270)</span>;</span><br><span class="line">    if (isLandscape || isRotatedPortrait) &#123;</span><br><span class="line">        return CellLayout<span class="string">.LANDSCAPE</span>;</span><br><span class="line">    &#125;</span> else &#123;</span><br><span class="line">        return CellLayout.PORTRAIT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="屏蔽Home键"><a href="#屏蔽Home键" class="headerlink" title="屏蔽Home键"></a>屏蔽Home键</h3><p>  重写onAttachedToWindow</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.getWindow().setType(WindowManager.LayoutParams.TYPE_KEYGUARD); <span class="keyword">super</span>.onAttachedToWindow(); &#125;  	</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (KeyEvent.KEYCODE_HOME == keyCode) &#123;</span><br><span class="line">            Toast.makeText(getApplicationContext(), <span class="string">"按了HOME 键..."</span>,Toast.LENGTH_LONG).show();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onKeyDown</span><span class="params">(keyCode, event)</span></span>; <span class="comment">//return true则将home键点击事件拦截</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android基础 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hexo]]></title>
      <url>http://codingtrip.com/2015/08/20/0002_Hexo/</url>
      <content type="html"><![CDATA[<h2 id="Hexo备份"><a href="#Hexo备份" class="headerlink" title="Hexo备份"></a>Hexo备份</h2><p>选择第三方git代码托管服务商进行备份，如github,coding,oschina等，我选择的是oschina和coding,因为你的站点配置文件或者主题配置文件中可能会涉及一些私密信息<br>，为了相对安全性，最好选择私有仓库进行备份，oschina和coding目前可建立免费的私有仓库。</p>
<p>推荐一个插件：<a href="https://github.com/coneycode/hexo-git-backup" target="_blank" rel="external">hexo-git-backup</a>，使用简单方便。<br><a id="more"></a></p>
<p>安装：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> hexo-git-<span class="keyword">backup</span></span></span><br></pre></td></tr></table></figure></p>
<p>修改站点配置文件_config.yml，加入以下内容：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">backup</span>:</span><br><span class="line">    <span class="attribute">type</span>: git</span><br><span class="line">    <span class="attribute">repository</span>:</span><br><span class="line">       <span class="attribute">oschina</span>: git<span class="variable">@github</span>.<span class="attribute">com</span>:xxx/xxx.git,branchName</span><br><span class="line">       <span class="attribute">coding</span>: git<span class="variable">@github</span>.<span class="attribute">com</span>:xxx/xxx.git,branchName</span><br></pre></td></tr></table></figure></p>
<p>提交备份：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">hexo</span> b</span><br></pre></td></tr></table></figure></p>
<p>如果想在其他机器上写博客，只需将仓库克隆，切换到站点目录下运行：<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span></span><br></pre></td></tr></table></figure></p>
<h2 id="hexo-g报错-Hexo-3-2-0版本-：Cannot-read-property-‘updated’-of-undefined"><a href="#hexo-g报错-Hexo-3-2-0版本-：Cannot-read-property-‘updated’-of-undefined" class="headerlink" title="hexo g报错(Hexo: 3.2.0版本)：Cannot read property ‘updated’ of undefined"></a>hexo g报错(Hexo: 3.2.0版本)：Cannot read property ‘updated’ of undefined</h2><p>hexo升级为3.2.0版本之后，hexo g报错：<br><figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">FATAL ejs:7</span><br><span class="line">    5|   <span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"</span></span></span>&lt;%-<span class="ruby"> encodeURI(feed_url) </span>%&gt;<span class="xml"><span class="tag"><span class="value">"</span> <span class="attribute">rel</span>=<span class="value">"self"</span>/&gt;</span></span><br><span class="line">    6|   <span class="tag">&lt;<span class="title">link</span> <span class="attribute">href</span>=<span class="value">"</span></span></span>&lt;%-<span class="ruby"> encodeURI(url) </span>%&gt;<span class="xml"><span class="tag"><span class="value">"</span>/&gt;</span></span><br><span class="line"> &gt;&gt; 7|   <span class="tag">&lt;<span class="title">updated</span>&gt;</span></span>&lt;%=<span class="ruby"> posts.first().updated.toISOString() </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">updated</span>&gt;</span></span><br><span class="line">    8|   <span class="tag">&lt;<span class="title">id</span>&gt;</span></span>&lt;%-<span class="ruby"> url </span>%&gt;<span class="xml"><span class="tag">&lt;/<span class="title">id</span>&gt;</span></span><br><span class="line">    9|   </span>&lt;%<span class="ruby"> <span class="keyword">if</span> (config.author)&#123; </span>%&gt;<span class="xml"></span><br><span class="line">    10|   <span class="tag">&lt;<span class="title">author</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Cannot read property 'updated' of undefined</span></span><br></pre></td></tr></table></figure></p>
<p>打开站点根目录文件：package.json，修改”dependencies”中hexo版本为：3.1.1，删除node_modules文件夹，重新运行：npm install<br>修改前：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"hexo-site"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"0.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">private</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">  "<span class="attribute">hexo</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">version</span>": <span class="value"><span class="string">"3.2.0"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">hexo</span>": <span class="value"><span class="string">"^3.1.1"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-deployer-git</span>": <span class="value"><span class="string">"0.0.4"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-archive</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-category</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-feed</span>": <span class="value"><span class="string">"~1.0.3"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-index</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-search</span>": <span class="value"><span class="string">"^1.0.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-sitemap</span>": <span class="value"><span class="string">"~1.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-tag</span>": <span class="value"><span class="string">"^0.1.1"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-git-backup</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-renderer-ejs</span>": <span class="value"><span class="string">"^0.1.0"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-renderer-marked</span>": <span class="value"><span class="string">"^0.2.4"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-renderer-stylus</span>": <span class="value"><span class="string">"^0.2.0"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-server</span>": <span class="value"><span class="string">"^0.1.3"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改后：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"hexo-site"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"0.0.0"</span></span>,</span><br><span class="line">  "<span class="attribute">private</span>": <span class="value"><span class="literal">true</span></span>,</span><br><span class="line">  "<span class="attribute">hexo</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">version</span>": <span class="value"><span class="string">"3.2.0"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">hexo</span>": <span class="value"><span class="string">"3.1.1"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-deployer-git</span>": <span class="value"><span class="string">"0.0.4"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-archive</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-category</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-feed</span>": <span class="value"><span class="string">"~1.0.3"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-index</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-search</span>": <span class="value"><span class="string">"^1.0.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-sitemap</span>": <span class="value"><span class="string">"~1.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-generator-tag</span>": <span class="value"><span class="string">"^0.1.1"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-git-backup</span>": <span class="value"><span class="string">"^0.1.2"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-renderer-ejs</span>": <span class="value"><span class="string">"^0.1.0"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-renderer-marked</span>": <span class="value"><span class="string">"^0.2.4"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-renderer-stylus</span>": <span class="value"><span class="string">"^0.2.0"</span></span>,</span><br><span class="line">    "<span class="attribute">hexo-server</span>": <span class="value"><span class="string">"^0.1.3"</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> 其他 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MarkDown 基础知识学习]]></title>
      <url>http://codingtrip.com/2015/08/02/0001_makrdown%E5%85%A5%E9%97%A8/</url>
      <content type="html"><![CDATA[<p>单个回车<br>视为空格</p>
<p>连续回车</p>
<p>视为分段<br><a id="more"></a><br>段内换行只需在行尾加两个空格  即可</p>
<p>&emsp;&emsp;输入空格</p>
<p><em>斜体显示</em></p>
<p><strong>粗体显示</strong></p>
<blockquote>
<p>表示引用内容</p>
</blockquote>
<h1 id="表示这是一级标题"><a href="#表示这是一级标题" class="headerlink" title="表示这是一级标题"></a>表示这是一级标题</h1><h2 id="表示这是二级标题"><a href="#表示这是二级标题" class="headerlink" title="表示这是二级标题"></a>表示这是二级标题</h2><h3 id="表示这是三级标题"><a href="#表示这是三级标题" class="headerlink" title="表示这是三级标题"></a>表示这是三级标题</h3><p>……</p>
<h6 id="最小是六级标题"><a href="#最小是六级标题" class="headerlink" title="最小是六级标题"></a>最小是六级标题</h6><h1 id="大标题"><a href="#大标题" class="headerlink" title="大标题"></a>大标题</h1><h2 id="小标题"><a href="#小标题" class="headerlink" title="小标题"></a>小标题</h2><h2 id="下面是分割线"><a href="#下面是分割线" class="headerlink" title="下面是分割线"></a>下面是分割线</h2><ul>
<li>这是无序项目表</li>
<li>这是无序项目表</li>
<li>这是无序项目表</li>
</ul>
<p>列表之间不可相邻,否则解释为嵌套列表</p>
<ol>
<li>这是有序项目表</li>
<li>这是有序项目表</li>
<li>这是有序项目表</li>
</ol>
<p>以下是嵌套列表展示</p>
<ul>
<li>外层列表<ul>
<li>内层列表</li>
</ul>
<ul>
<li>再嵌套一层<ul>
<li>再来一层</li>
</ul>
</li>
</ul>
<ul>
<li>内层列表</li>
</ul>
</li>
<li>外层列表</li>
</ul>
<hr>
<p>把Url解释为超链接: <a href="http://codingtrip.com/">coding trip</a></p>
<p>图像与链接方式类似,只在前面加一个惊叹号: <img src="http://www.turingbook.com/Content/img/Turing.Gif" alt="这是图片"></p>
<p>图片设定大小并居中显示（前后最好加上回车）</p>
<div align="center"><br><img src="http://www.turingbook.com/Content/img/Turing.Gif" width="500" height="100" alt="test"><br></div>

<p>不设置大小并居左</p>
<div align="left"><br><img src="http://www.turingbook.com/Content/img/Turing.Gif" alt="test"><br></div>

<p>MarkDown还支持索引方式,可以把url写在文章最后:</p>
<p><a href="http://codingtrip.com/">coding trip</a><br><img src="http://www.turingbook.com/Content/img/Turing.Gif" alt="图片"></p>
<hr>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>每行文字前加4个空格或者1个Tab,即解释为代码:</p>
<pre><code>void print(){
Log.d(TAG,&quot;markdown learning&quot;);
}
</code></pre><p>前后插入“<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure></p>
<p>  void print(){<br>    Log.d(TAG,”markdown learning”);<br>    }<br>  ```</p>
<p>本来参考来自: <a href="http://www.ituring.com.cn/article/23" target="_blank" rel="external">图灵社区</a></p>
]]></content>
      
        <categories>
            
            <category> 其他 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> MarkDown </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[DailyNotes]]></title>
      <url>http://codingtrip.com/2015/07/24/0000_DailyNotes/</url>
      <content type="html"><![CDATA[<p>(本文旨在记录一些日后工作生活可能会用到的内容)</p>
<h1 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h1><h2 id="MarkDown编辑器"><a href="#MarkDown编辑器" class="headerlink" title="MarkDown编辑器"></a>MarkDown编辑器</h2><h3 id="1、Atom-github出的编辑器；功能十分强大，支持各种编程语言；关键可实时预览MarkDown编辑效果"><a href="#1、Atom-github出的编辑器；功能十分强大，支持各种编程语言；关键可实时预览MarkDown编辑效果" class="headerlink" title="1、Atom : github出的编辑器；功能十分强大，支持各种编程语言；关键可实时预览MarkDown编辑效果"></a>1、<a href="https://atom.io/" target="_blank" rel="external">Atom</a> : github出的编辑器；功能十分强大，支持各种编程语言；关键可实时预览MarkDown编辑效果</h3><h3 id="2、Visual-Studio-Code"><a href="#2、Visual-Studio-Code" class="headerlink" title="2、Visual Studio Code"></a>2、<a href="https://www.visualstudio.com/products/code-vs" target="_blank" rel="external">Visual Studio Code</a></h3><h3 id="3、notepad"><a href="#3、notepad" class="headerlink" title="3、notepad++"></a>3、<a href="https://notepad-plus-plus.org//" target="_blank" rel="external">notepad++</a></h3><a id="more"></a>
<h2 id="OS-X-常用软件"><a href="#OS-X-常用软件" class="headerlink" title="OS X 常用软件"></a>OS X 常用软件</h2><h3 id="1、Caffeine"><a href="#1、Caffeine" class="headerlink" title="1、Caffeine"></a>1、Caffeine</h3><p>一款可自由设置常亮，不熄屏的软件</p>
<h3 id="2、MplayerX-一款很不错的本地视频播放器"><a href="#2、MplayerX-一款很不错的本地视频播放器" class="headerlink" title="2、MplayerX :一款很不错的本地视频播放器"></a>2、<a href="http://mplayerx.org/" target="_blank" rel="external">MplayerX</a> :一款很不错的本地视频播放器</h3><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="lantern-网页翻墙神器，免费github地址"><a href="#lantern-网页翻墙神器，免费github地址" class="headerlink" title="lantern:网页翻墙神器，免费github地址"></a><a href="https://getlantern.org/" target="_blank" rel="external">lantern</a>:网页翻墙神器，免费<a href="https://github.com/getlantern/lantern" target="_blank" rel="external">github地址</a></h3><p>gsettings set org.gnome.desktop.media-handling automount-open false</p>
]]></content>
      
        <categories>
            
            <category> 其他 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
